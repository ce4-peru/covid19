infestaciondf= mutate ( infestaciondf,unifecha=paste(unicode,fec_captura,sep = "-" ))
View(inspeccionesdf)
View(infestaciondf)
infestaciondf<-infestaciondf %>%
select(unifecha,intra,cap_total)
View(infestaciondf)
write.csv(infestaciondf, "~/cimex_aqp/Cimex_Archivos/data/infestacion_tesis.csv",row.names = FALSE)
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
View(inspeccionesdf)
View(inspeccionesdf)
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha, etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,)
infestaciondf<-fread("~/cimex_aqp/Cimex_Archivos/data/infestacion_tesis.csv")
View(infestaciondf)
library(data.table)
library(dplyr)
#### tipo de ambiente, numero de personas en el ambiente ,tipo de vivienda,
####
####  infestacion formato dos
infestaciondf<-fread("~/Downloads/Formato2_Cimex - Formato2_Cimex (1).csv")
infestaciondf <- infestaciondf %>%
dplyr::mutate(
fec_captura = base::gsub("-", "/", fec_captura))
infestaciondf <- infestaciondf %>%
dplyr::mutate(
fec_captura = base::gsub("1", "01", fec_captura))
infestaciondf= mutate ( infestaciondf,unifecha=paste(unicode,fec_captura,sep = "-" ))
infestaciondf<-fread("~/cimex_aqp/Cimex_Archivos/data/infestacion_tesis.csv")
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
pareddf<-fread("~/Downloads/archive/result_match_pared_final.csv")
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha, etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all = TRUE)
View(total)
View(inspeccionesdf)
total<-merge(total,cuartodf,by="unifecha",all.x = TRUE)
View(total)
View(total)
View(cuartodf)
View(cuartodf)
names(cuartodf)
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
cuartodf<- cuartodf%>%
select(unifecha,codigo_cuartom,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
cuartodf<- cuartodf%>%
select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
View(cuartodf)
pareddf<-fread("~/Downloads/archive/result_match_pared_final.csv")
View(pareddf)
names(pareddf)
pareddf<-fread("~/Downloads/archive/result_match_pared_final.csv")
pareddf<- pareddf%>%
select(unifecha,cod_cuarto,lad_pte,sillar_pte,madera_pte,piedra_pte,noble_pte,adobe_pte,calamina_pte
drywall_pte,carrizo_pte,bloqueta_pte,plastico_pte,otro_pte,grietas)
pareddf<-fread("~/Downloads/archive/result_match_pared_final.csv")
pareddf<- pareddf%>%
select(unifecha,cod_cuarto,lad_pte,sillar_pte,madera_pte,piedra_pte,noble_pte,adobe_pte,calamina_pte,
drywall_pte,carrizo_pte,bloqueta_pte,plastico_pte,otro_pte,grietas)
View(pareddf)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all = TRUE)
total<- total%>%
select(unifecha, unicode,id_proyecto,etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,cap_total)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all = TRUE)
total<-merge(total,cuartodf,by="unifecha",all.x = TRUE)
View(cuartodf)
total<-merge(total,cuartodf,by="unifecha",all = TRUE)
View(cuartodf)
total<-merge(total,cuartodf,by="unifecha",all = TRUE,allow.cartesian = TRUE)
View(total)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all = TRUE)
infestaciondf<-fread("~/cimex_aqp/Cimex_Archivos/data/infestacion_tesis.csv")
# infestaciodf_1<-aggregate(cap_total~unifecha,data = infestaciondf,sum)
#### tipo de ambiente, numero de personas en el ambiente ,tipo de vivienda,
###### cuartos , pared , inspeccciones
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
cuartodf<- cuartodf%>%
select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
pareddf<-fread("~/Downloads/archive/result_match_pared_final.csv")
pareddf<- pareddf%>%
select(unifecha,cod_cuarto,lad_pte,sillar_pte,madera_pte,piedra_pte,noble_pte,adobe_pte,calamina_pte,
drywall_pte,carrizo_pte,bloqueta_pte,plastico_pte,otro_pte,grietas)
##### INSPECCIONES
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha, etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,)
############# merges de las bases de datos de chicnches con la positividad ###########
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all = TRUE)
View(total)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all.x = TRUE)
View(total)
View(total)
write.csv("~/cimex_aqp/Cimex_Archivos/data/total_infest_inspecc.csv",row.names = FALSE)
write.csv(total,"~/cimex_aqp/Cimex_Archivos/data/total_infest_inspecc.csv",row.names = FALSE)
View(total)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all.x = TRUE)
sapply(total, class)
total$cap_total<-as.numeric(total$cap_total)
total$total_perso<-as.numeric(total$total_perso)
sapply(total, class)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all.x = TRUE)
total$cap_total<-as.numeric(total$cap_total)
total$total_perso<-as.numeric(total$total_perso)
write.csv(total,"~/cimex_aqp/Cimex_Archivos/data/total_infest_inspecc.csv",row.names = FALSE)
is.na(total)<-0
is.na(total$cap_total)<-0
is.na(total$total_perso)<-0
write.csv(total,"~/cimex_aqp/Cimex_Archivos/data/total_infest_inspecc.csv",row.names = FALSE)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all.x = TRUE)
View(cuartodf)
View(cuartodf)
View(cuartodf)
cuartodf= mutate ( cuartodf,unifechacuarto=paste(unicode,fec_captura,codigo_cuarto,sep = "-" ))
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
cuartodf<- cuartodf%>%
select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
cuartodf= mutate ( cuartodf,unifechacuarto=paste(unifecha,codigo_cuarto,sep = "-" ))
View(cuartodf)
infestaciondf<-fread("~/cimex_aqp/Cimex_Archivos/data/infestacion_tesis.csv")
View(infestaciondf)
View(infestaciondf)
View(cuartodf)
infestaciondf<-fread("~/cimex_aqp/Cimex_Archivos/data/infestacion_tesis.csv")
infestaciondf<-infestaciondf%>% rename(codigo_cuarto=intra)
View(infestaciondf)
infestaciondf= mutate ( infestaciondf,unifechacuarto=paste(unifecha,codigo_cuarto,sep = "-" ))
View(infestaciondf)
infestaciondf<- infestaciondf%>%
select(unifechacuarto,cap_total)
View(infestaciodf_1)
View(infestaciondf)
pareddf<-fread("~/Downloads/archive/result_match_pared_final.csv")
View(pareddf)
lab<-merge(infestaciondf,cuartodf,by="unifechacuarto",all.x = TRUE)
View(lab)
View(lab)
is.na(lab)<-888
lab[is.na(lab)] <- 888
View(lab)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all.x = TRUE)
total<- merge(infestaciondf,inspeccionesdf, by= "unifecha", all.x = TRUE)
View(total)
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha, etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,)
View(infestaciondf)
infestaciondf<-fread("~/cimex_aqp/Cimex_Archivos/data/infestacion_tesis.csv")
infestaciondf<-infestaciondf%>% rename(codigo_cuarto=intra)
infestaciondf= mutate ( infestaciondf,unifechacuarto=paste(unifecha,codigo_cuarto,sep = "-" ))
infestaciondf<- infestaciondf%>%
select(unifecha, unifechacuarto,cap_total)
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
cuartodf<- cuartodf%>%
select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
cuartodf= mutate ( cuartodf,unifechacuarto=paste(unifecha,codigo_cuarto,sep = "-" ))
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha, etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,)
lab<-merge(infestaciondf,cuartodf,by="unifechacuarto",all.x = TRUE)
lab[is.na(lab)] <- 888
View(lab)
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha, etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,)
View(inspeccionesdf)
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
cuartodf<- cuartodf%>%
select(codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
cuartodf= mutate ( cuartodf,unifechacuarto=paste(unifecha,codigo_cuarto,sep = "-" ))
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
cuartodf<- cuartodf%>%
select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
cuartodf= mutate ( cuartodf,unifechacuarto=paste(unifecha,codigo_cuarto,sep = "-" ))
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
View(cuartodf)
cuartodf<- cuartodf%>%
select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
cuartodf= mutate ( cuartodf,unifechacuarto=paste(unifecha,codigo_cuarto,sep = "-" ))
select(unifechacuarto,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
cuartodf<-fread("~/Downloads/archive/result_match_cuarto_final.csv")
cuartodf<- cuartodf%>%
select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
cuartodf= mutate ( cuartodf,unifechacuarto=paste(unifecha,codigo_cuarto,sep = "-" ))
View(cuartodf)
View(cuartodf)
cuartodf<- cuartodf%>%
select(unifechacuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen)
View(cuartodf)
lab<-merge(infestaciondf,cuartodf,by="unifechacuarto",all.x = TRUE)
View(lab)
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha, etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,)
############# merges de las bases de datos de chicnches con la positividad ###########
totalaux<- merge(infestaciondf,lab, by = "unifecha", all.x = TRUE)
View(totalaux)
lab<-merge(infestaciondf,cuartodf,by="unifechacuarto",all.x = TRUE)
View(lab)
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha, etapa,situacion,hotel_depart_vivienda,e,c,r,des,lv,lp,insp_pos_chinche,
total_perso,cuy,conejo,perro,gato,aves,otros,comentario,)
View(inspeccionesdf)
inspeccionesdf[is.na(inspeccionesdf)] <- 888
View(inspeccionesdf)
inspeccionesdf<-fread("~/Downloads/Inspecciones_chinches - Inspecciones chinches (5).csv")
inspeccionesdf<-inspeccionesdf %>% rename_all(tolower)
inspeccionesdf <- inspeccionesdf %>%
dplyr::mutate(
fecha = base::gsub("_", "/", fecha))
inspeccionesdf= mutate ( inspeccionesdf,unifecha=paste(unicode,fecha,sep = "-" ))
inspeccionesdf<- inspeccionesdf%>%
select(unifecha,hotel_depart_vivienda,insp_pos_chinche,
total_perso)
inspeccionesdf[is.na(inspeccionesdf)] <- 888
View(inspeccionesdf)
View(lab)
View(inspeccionesdf)
totalaux<- merge(inspeccionesdf,lab, by = "unifecha", all.x = TRUE)
View(totalaux)
totalaux<- merge(lab,inspeccionesdf by = "unifecha", all.x = TRUE)
totalaux<- merge(lab,inspeccionesdf, by = "unifecha", all.x = TRUE)
View(totalaux)
totalaux[is.na(totalaux)] <- 888
View(totalaux)
write.csv(totalaux,"~/cimex_aqp/Cimex_Archivos/data/total_infest_inspecc.csv",row.names = FALSE)
View(totalaux)
library(tidyverse)
library(data.table)
library(plyr)
setwd("~/covid19/data/modificadas")
df0 <- read.csv("covidPE_IND_20200408_MD_clean.csv")
table(df0$REGION)
#Format data frame
df0 <- df0[2:17]
colnames(df0) <- c("ID", "Date", "Day", "Month", "Year", "Region", "Provence", "Disctrict",
"Direction", "Age1", "Age", "Sex", "Hospitilized", "AISLADODOMICILS1N0",
"Contact","Imported") #KEY: Sex:M=1,F=0|Hospitilized:Yes=1,No=0|Imported:Yes=1,No=0)
#df0$Date <- as.Date(df0$Date, "%m/%d/%Y") #Fix date format
df0$Date <- as.Date(df0$Date)
df0 <- df0[1:6]
df0$count<-unlist(1)
dfag<- aggregate(count ~ Region, data = df0, sum)
dfag$id=seq(1,24)
View(dfag)
View(dfag)
dfag<-filter(dfag, variable %in% target)
View(dfag)
dfag<-filter(dfag, Region %in% target)
target <- c("LIMA")
dfag<-filter(dfag, !Region %in% target)
View(dfag)
Regions <- levels(droplevels(unique(df0$Region))) #Regions
Dates <- as.data.frame(seq(as.Date(min(df0$Date)), as.Date(max(df0$Date)), "days")); colnames(Dates) <- c("Date") #Dates
label_data<- dfag
# calculate the ANGLE of the labels
number_of_bar <- nrow(label_data)
angle <-  90 - 360 * (label_data$id-0.5) /number_of_bar     # I substract 0.5 because the letter must have the angle of the center of the bars. Not extreme right(1) or extreme left (0)
# calculate the alignment of labels: right or left
# If I am on the left part of the plot, my labels have currently an angle < -90
label_data$hjust<-ifelse( angle < -90, 1, 0)
# flip angle BY to make them readable
label_data$angle<-ifelse(angle < -90, angle+180, angle)
label_data$per<- label_data$count*100/sum(label_data$count)
options(digits=2)
label_data$Region <- revalue(label_data$Region,
c("ANCASH"="ANC",
"AREQUIPA"="AQP",
"AYACUCHO" ="AYA",
"CAJAMARCA"="CAJ",
"CALLAO"="CAL",
"CUSCO" ="CUS",
"HUANUCO" ="HCO",
"ICA" ="ICA",
"JUNIN" ="JUN",
"LA LIBERTAD" ="LAL",
"LAMBAYEQUE" ="LAM",
"LIMA" ="LIM",
"LORETO"="LOR",
"MADRE DE DIOS"="MDD",
"PASCO" ="PAS",
"PIURA"="PIU",
"SAN MARTIN"="SAM",
"TACNA" ="TAC",
"TUMBES" ="TUM",
"AMAZONAS" ="AMA",
"MOQUEGUA"="MOQ",
"APURIMAC"="APU",
"HUANCAVELICA"="HUV",
"PUNO"="PUN",
"UCAYALI"="UCA"))
label_data$Region <- paste(label_data$Region, " (", round(label_data$per,digits = 2),")", sep="")
p <- ggplot(dfag, aes(x=as.factor(id), y=label_data$count)) +       # Note that id is a factor. If x is numeric, there is some space between the first bar
# This add the bars with a blue color
geom_bar(stat="identity", fill=alpha("green", 0.7)) +
# Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
ylim(-10,100) +
# Custom the theme: no axis title and no cartesian grid
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(rep(-1,100), "cm")      # Adjust the margin to make in sort labels are not truncated!
) +
# This makes the coordinate polar instead of cartesian.
coord_polar(start = 0) +
# Add the labels, using the label_data dataframe that we have created before
geom_text(data=label_data, aes(x=id, y=count+10, label=Region, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.5, angle= label_data$angle, inherit.aes = FALSE )
p
p <- ggplot(dfag, aes(x=as.factor(id), y=label_data$count)) +       # Note that id is a factor. If x is numeric, there is some space between the first bar
# This add the bars with a blue color
geom_bar(stat="identity", fill=alpha("green", 0.7)) +
# Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
ylim(-10,100) +
# Custom the theme: no axis title and no cartesian grid
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(rep(-1,10), "cm")      # Adjust the margin to make in sort labels are not truncated!
) +
# This makes the coordinate polar instead of cartesian.
coord_polar(start = 0) +
# Add the labels, using the label_data dataframe that we have created before
geom_text(data=label_data, aes(x=id, y=count+10, label=Region, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.5, angle= label_data$angle, inherit.aes = FALSE )
p
p <- ggplot(dfag, aes(x=as.factor(id), y=label_data$count)) +       # Note that id is a factor. If x is numeric, there is some space between the first bar
# This add the bars with a blue color
geom_bar(stat="identity", fill=alpha("green", 0.7)) +
# Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
ylim(-10,120) +
# Custom the theme: no axis title and no cartesian grid
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(rep(-10,10), "cm")      # Adjust the margin to make in sort labels are not truncated!
) +
# This makes the coordinate polar instead of cartesian.
coord_polar(start = 0) +
# Add the labels, using the label_data dataframe that we have created before
geom_text(data=label_data, aes(x=id, y=count+10, label=Region, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.5, angle= label_data$angle, inherit.aes = FALSE )
p
p <- ggplot(dfag, aes(x=as.factor(id), y=label_data$count)) +       # Note that id is a factor. If x is numeric, there is some space between the first bar
# This add the bars with a blue color
geom_bar(stat="identity", fill=alpha("green", 0.7)) +
# Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
ylim(-10,120) +
# Custom the theme: no axis title and no cartesian grid
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(rep(-1,1), "cm")      # Adjust the margin to make in sort labels are not truncated!
) +
# This makes the coordinate polar instead of cartesian.
coord_polar(start = 0) +
# Add the labels, using the label_data dataframe that we have created before
geom_text(data=label_data, aes(x=id, y=count+10, label=Region, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.5, angle= label_data$angle, inherit.aes = FALSE )
p
# This add the bars with a blue color
p <- ggplot(dfag, aes(x=as.factor(id), y=label_data$count)) +       # Note that id is a factor. If x is numeric, there is some space between the first bar
# This add the bars with a blue color
geom_bar(stat="identity", fill=alpha("green", 0.7)) +
# Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
ylim(-10,120) +
# Custom the theme: no axis title and no cartesian grid
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(rep(-1,10), "cm")      # Adjust the margin to make in sort labels are not truncated!
) +
# This makes the coordinate polar instead of cartesian.
coord_polar(start = 0) +
# Add the labels, using the label_data dataframe that we have created before
geom_text(data=label_data, aes(x=id, y=count+10, label=Region, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.5, angle= label_data$angle, inherit.aes = FALSE )
p
label_data<- dfag
# calculate the ANGLE of the labels
number_of_bar <- nrow(label_data)
angle <-  90 - 360 * (label_data$id-0.5) /number_of_bar     # I substract 0.5 because the letter must have the angle of the center of the bars. Not extreme right(1) or extreme left (0)
# calculate the alignment of labels: right or left
# If I am on the left part of the plot, my labels have currently an angle < -90
label_data$hjust<-ifelse( angle < -90, 1, 0)
# flip angle BY to make them readable
label_data$angle<-ifelse(angle < -90, angle+180, angle)
label_data$Region <- revalue(label_data$Region,
c("ANCASH"="ANC",
"AREQUIPA"="AQP",
"AYACUCHO" ="AYA",
"CAJAMARCA"="CAJ",
"CALLAO"="CAL",
"CUSCO" ="CUS",
"HUANUCO" ="HCO",
"ICA" ="ICA",
"JUNIN" ="JUN",
"LA LIBERTAD" ="LAL",
"LAMBAYEQUE" ="LAM",
"LIMA" ="LIM",
"LORETO"="LOR",
"MADRE DE DIOS"="MDD",
"PASCO" ="PAS",
"PIURA"="PIU",
"SAN MARTIN"="SAM",
"TACNA" ="TAC",
"TUMBES" ="TUM",
"AMAZONAS" ="AMA",
"MOQUEGUA"="MOQ",
"APURIMAC"="APU",
"HUANCAVELICA"="HUV",
"PUNO"="PUN",
"UCAYALI"="UCA"))
label_data$Region <- paste(label_data$Region, " (", round(label_data$per,digits = 2),")", sep="")
View(label_data)
p <- ggplot(dfag, aes(x=as.factor(id), y=label_data$count)) +       # Note that id is a factor. If x is numeric, there is some space between the first bar
# This add the bars with a blue color
geom_bar(stat="identity", fill=alpha("green", 0.7)) +
# Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
ylim(-10,120) +
# Custom the theme: no axis title and no cartesian grid
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(rep(-1,10), "cm")      # Adjust the margin to make in sort labels are not truncated!
) +
# This makes the coordinate polar instead of cartesian.
coord_polar(start = 0) +
# Add the labels, using the label_data dataframe that we have created before
geom_text(data=label_data, aes(x=id, y=count+10, label=Region, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.5, angle= label_data$angle, inherit.aes = FALSE )
p
p <- ggplot(dfag, aes(x=as.factor(id), y=label_data$count)) +       # Note that id is a factor. If x is numeric, there is some space between the first bar
# This add the bars with a blue color
geom_bar(stat="identity", fill=alpha("green", 0.7)) +
# Limits of the plot = very important. The negative value controls the size of the inner circle, the positive one is useful to add size over each bar
ylim(-10,120) +
# Custom the theme: no axis title and no cartesian grid
theme_minimal() +
theme(
axis.text = element_blank(),
axis.title = element_blank(),
panel.grid = element_blank(),
plot.margin = unit(rep(-1,4), "cm")      # Adjust the margin to make in sort labels are not truncated!
) +
# This makes the coordinate polar instead of cartesian.
coord_polar(start = 0) +
# Add the labels, using the label_data dataframe that we have created before
geom_text(data=label_data, aes(x=id, y=count+10, label=Region, hjust=hjust), color="black", fontface="bold",alpha=0.6, size=2.5, angle= label_data$angle, inherit.aes = FALSE )
p
View(pals.bin.risk)
