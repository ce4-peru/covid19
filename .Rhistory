###### limpieza casos por indartamento #####
library(data.table)
library(dplyr)
library(tidyr)
library(tidyverse)
library(lubridate)
## set directory
setwd("~/covid19PE-LIEZ/")
## Call data
# covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200326_MD.csv")
# covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200327_MD.csv")
#covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200331_MD.csv")
covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200401_MD.csv")
## set directory
setwd("~/covid19")
## Call data
# covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200326_MD.csv")
# covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200327_MD.csv")
#covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200331_MD.csv")
covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200401_MD.csv")
## Call data
# covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200326_MD.csv")
# covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200327_MD.csv")
#covid_ind <- fread("~/ce4-peru.github.io/data/crudas/covidPE_IND_20200331_MD.csv")
covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200401_MD.csv")
## Checar base
str(covid_ind) # 850 obs. of  20 variables
names(covid_ind)
# [1] "CASO_ID"              "FECHA"                "REGION"
# [4] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [7] "EDAD_A"               "SEXOM1H0"             "HOSPITALIZADOS1N0"
# [10] "AISLADODOMICILS1N0"   "CONTACTO"             "IMPORTADO"
# [13] "ORIGEN_INTERNACIONAL" "CASO_CONTACTO"        "RELACION_CONTACTO"
# [16] "ORIGEN_NACIONAL"      "ENLACES1"             "ENLACES2"
# [19] "ENLACES3"             "OBSERVACIONES"
# Mas adelante  Sacar los "S1N0 del nombre de la variable
head(covid_ind)
# Transformar todo texto a mayusculas
# Transform to character
covid_ind <- mutate_if(covid_ind, is.character, toupper)
sapply(covid_ind, class)
# "integer"          "character"          "character"          "character"
# DISTRITO            DIRECCION               EDAD_A             SEXOM1H0
# "character"            "logical"          "character"            "integer"
# HOSPITALIZADOS1N0   AISLADODOMICILS1N0             CONTACTO            IMPORTADO
# "integer"            "integer"          "character"            "integer"
# ORIGEN_INTERNACIONAL        CASO_CONTACTO    RELACION_CONTACTO      ORIGEN_NACIONAL
# "character"            "integer"          "character"          "character"
# ENLACES1             ENLACES2             ENLACES3        OBSERVACIONES
# "character"          "character"          "character"          "character"
### variableby variable
### Caso_ID ###
table(covid_ind$CASO_ID)
# 1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22
# 1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
# 23  24  25  26  27  28  44  69  71  73 106 145
# 1   1   1   1   1   1   1   1   1   1   1   1
### Fecha ####
table(covid_ind$FECHA)
# 06/03/2020 07/03/2020 09/03/2020 10/03/2020 11/03/2020 12/03/2020 13/03/2020
# 1          5          3          2          6          5         16
# 14/03/2020 15/03/2020 16/03/2020 17/03/2020 18/03/2020 19/03/2020 20/03/2020
# 5         28         15         31         29         89         29
# 21/03/2020 22/03/2020 23/03/2020 24/03/2020 25/03/2020 26/03/2020 27/03/2020
# 55         43         32         21         64         99         55
# 28/03/2020 29/03/2020
# 36        181
#### separando caracteres en varias columnas ######
covid_ind$FECHA2 <- covid_ind$FECHA
covid_ind <- separate(covid_ind,
col = "FECHA2",
into = c("DIA", "MES","ANO"),
sep = "/")
##### fecha to as.date format ####
covid_ind<-covid_ind %>%
mutate(FECHA = as.Date(as.character(FECHA), format = "%d/%m/%y"))
### ordenar base ###
names(covid_ind)
covid_ind <- covid_ind[,c(1, 2, 21:23, 3:20)]
# ID del caso
str(covid_ind$CASO_ID) # int
unique(covid_ind$CASO_ID)
## Fecha
str(covid_ind$FECHA) # date
unique(covid_ind$FECHA)
## Region
str(covid_ind$REGION) # character
# Cambiar nombre de variable en googlesheet
unique(covid_ind$REGION)
# Cambiar Huanuco
levels(covid_ind$REGION) <- c(levels(covid_ind$REGION),
c("APURIMAC", "HUANUCO",
"JUNIN", "SAN MARTIN"))
covid_ind$REGION[covid_ind$REGION == "HUÃ¡NUCO"] <- "HUANUCO"
unique(covid_ind$REGION) # ok
## Provincia
str(covid_ind$PROVINCIA) # chr
unique(covid_ind$PROVINCIA)
levels(covid_ind$PROVINCIA) <- c(levels(covid_ind$PROVINCIA),
c("APURIMAC", "HUANUCO",
"JUNIN", "SAN MARTIN", "FERRENAAFE"))
covid_ind$PROVINCIA[covid_ind$PROVINCIA == "FERREÃ±AFE"] <- "FERRENAFE"
covid_ind$PROVINCIA[covid_ind$PROVINCIA == ""] <- NA
unique(covid_ind$PROVINCIA)
## Distrito
str(covid_ind$DISTRITO) # chr
unique(covid_ind$DISTRITO)
# Hay  ""
covid_ind$DISTRITO[covid_ind$DISTRITO == ""] <- NA
unique(covid_ind$DISTRITO)
## Direccion
str(covid_ind$DIRECCION) # logi
unique(covid_ind$DIRECCION) # NA
## Edad
str(covid_ind$EDAD_A) # chr
