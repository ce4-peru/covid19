## Call data
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200326_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200327_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200331_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200401_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200402_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200403_MD.csv")
#covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200404_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_202004005_CA.csv")
covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_202004006_CA.csv")
###### limpieza casos por indartamento #####
library(data.table)
library(dplyr)
library(tidyr)
library(tidyverse)
library(lubridate)
## set directory
setwd("~/covid19")
## Call data
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200326_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200327_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200331_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200401_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200402_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200403_MD.csv")
#covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200404_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_202004005_CA.csv")
covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_202004006_CA.csv")
## Call data
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200326_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200327_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200331_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200401_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200402_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200403_MD.csv")
#covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200404_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_202004005_CA.csv")
covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_202004006_MD.csv")
## Call data
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200326_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200327_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200331_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200401_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200402_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200403_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200404_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200405_CA.csv")
covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200406_MD.csv")
## Checar base
str(covid_ind) # 1595 obs. of  20 variables
names(covid_ind)
head(covid_ind)
# Transform to character
covid_ind <- mutate_if(covid_ind, is.character, toupper)
sapply(covid_ind, class)
### variableby variable
### Caso_ID ###
table(covid_ind$CASO_ID)
### Fecha ####
table(covid_ind$FECHA)
covid_ind$FECHA2 <- covid_ind$FECHA
covid_ind <- separate(covid_ind,
col = "FECHA2",
into = c("DIA", "MES","ANO"),
sep = "/")
##### fecha to as.date format ####
covid_ind<-covid_ind %>%
mutate(FECHA = as.Date(as.character(FECHA), format = "%d/%m/%y"))
### ordenar base ###
names(covid_ind)
# [1] "CASO_ID"              "FECHA"                "REGION"
# [4] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [7] "EDAD_A"               "SEXOM1H0"             "HOSPITALIZADOS1N0"
# [10] "AISLADODOMICILS1N0"   "CONTACTO"             "IMPORTADO"
# [13] "ORIGEN_INTERNACIONAL" "CASO_CONTACTO"        "RELACION_CONTACTO"
# [16] "ORIGEN_NACIONAL"      "ENLACES1"             "ENLACES2"
# [19] "ENLACES3"             "OBSERVACIONES"        "DIA"
# [22] "MES"                  "ANO"
covid_ind <- covid_ind[,c(1, 2, 21:23, 3:20)]
str(covid_ind$CASO_ID) # int
unique(covid_ind$CASO_ID)
### Para manejo nuestro, completar n[umero de casos en google spreadsheet.
## Fecha
str(covid_ind$FECHA) # date
unique(covid_ind$FECHA)
# ok
## Region
str(covid_ind$REGION) # character
# Cambiar nombre de variable en googlesheet
unique(covid_ind$REGION)
# Cambiar Huanuco
levels(covid_ind$REGION) <- c(levels(covid_ind$REGION),
c("APURIMAC", "HUANUCO",
"JUNIN", "SAN MARTIN"))
covid_ind$REGION[covid_ind$REGION == "HUÃ¡NUCO"] <- "HUANUCO"
covid_ind$REGION[covid_ind$REGION == ""] <- NA
unique(covid_ind$REGION) # ok
## Provincia
str(covid_ind$PROVINCIA) # chr
unique(covid_ind$PROVINCIA)
levels(covid_ind$PROVINCIA) <- c(levels(covid_ind$PROVINCIA),
c("APURIMAC", "HUANUCO",
"JUNIN", "SAN MARTIN", "FERRENAFE"))
covid_ind$PROVINCIA[covid_ind$PROVINCIA == "FERREÃ±AFE"] <- "FERRENAFE"
covid_ind$PROVINCIA[covid_ind$PROVINCIA == ""] <- NA
unique(covid_ind$PROVINCIA)
## Distrito
str(covid_ind$DISTRITO) # chr
unique(covid_ind$DISTRITO)
# [71] "ZORRITOS"                      "NAUTA"
# [73] "CORRALES"                      "MAJES"
# [75] "KAQUIABAMBA"                   "PUNCHANA"
# [77] "SAN JUAN BAUTISTA"             "ILLIMO"
# [79] "BELEN"                         "VILLA RICA"
# [81] "CHIMBOTE"                      "CORACORA"
# [83] "PUQUINA"                       "AYACUCHO"
# [85] "LS ESPERANZA"                  "PACASMAYO"
# [87] "CHAUPIMARCA"
# # Hay  ""
covid_ind$DISTRITO[covid_ind$DISTRITO == "FERREÃ±AFE"] <- "FERRENAFE"
covid_ind$DISTRITO[covid_ind$DISTRITO == ""] <- NA
unique(covid_ind$DISTRITO)
## Direccion
str(covid_ind$DIRECCION) # logi
unique(covid_ind$DIRECCION) # NA
## Edad
str(covid_ind$EDAD_A) # chr
covid_ind$EDAD_A_n <- as.numeric(covid_ind$EDAD_A)
str(covid_ind$EDAD_A_n)# ok
table(covid_ind$EDAD_A_n) # ok, from 2 to 96.
covid_ind$EDAD_A[covid_ind$EDAD_A == ""] <- NA
## Sexo
str(covid_ind$SEXOM1H0) # int
table(covid_ind$SEXOM1H0) # 0 and 1
table(covid_ind$HOSPITALIZADOS1N0) # 0 and 1
str(covid_ind$AISLADODOMICILS1N0) # int
table(covid_ind$AISLADODOMICILS1N0) # 0 and 1
# 0   1
# 43 159
## cONTACTO
str(covid_ind$CONTACTO) # CHR
unique(covid_ind$CONTACTO)
# Dividir en 3 o 4 columnas esta inforamci[on como se indic[o en el googlesheet.
covid_ind$CONTACTO[covid_ind$CONTACTO == ""] <- NA
## IMPORTADO
str(covid_ind$IMPORTADO) # int
unique(covid_ind$IMPORTADO)
# [1] "1"    "0"    NA
covid_ind$IMPORTADO[covid_ind$IMPORTADO == "LINK"] <- NA
covid_ind$IMPORTADO[covid_ind$IMPORTADO == ""] <- NA
## ORIGEN_INTERNACIONAL
str(covid_ind$ORIGEN_INTERNACIONAL) # chr
unique(covid_ind$ORIGEN_INTERNACIONAL)
# [1] "EUROPA"        ""              "UK"            "ESPANA"        "ITALIA"
# [6] "WASHINGTON DC" "EEUU"
# Hay ""
covid_ind$ORIGEN_INTERNACIONAL[covid_ind$ORIGEN_INTERNACIONAL == ""] <- NA
unique(covid_ind$ORIGEN_INTERNACIONAL)
covid_ind$ORIGEN_INTERNACIONAL[covid_ind$ORIGEN_INTERNACIONAL == "LINK 2"] <- NA
## CASO_CONTACTO
str(covid_ind$CASO_CONTACTO) # int
unique(covid_ind$CASO_CONTACTO)
## RELACION_CONTACTO
str(covid_ind$RELACION_CONTACTO) # chr
unique(covid_ind$RELACION_CONTACTO)
# [1] NA     "FAMILIAR"    "AMIGO"       ""    "TURISTA"     "RELACIONADO"
# Hay ""
covid_ind$RELACION_CONTACTO[covid_ind$RELACION_CONTACTO == ""] <- NA
## ORIGEN_NACIONAL
str(covid_ind$ORIGEN_NACIONAL) # chr
unique(covid_ind$ORIGEN_NACIONAL)
# [1] "LIMA"           "AREQUIPA"       "HUANUCO"        "CHINCHA"        ""
# [6] "CUSCO"          "NUEVO CHIMBOTE" "HUANCHACO"      "LA VICTORIA"    "PIURA"
# [11] "CHICLAYO"       "IQUITOS"        "TRUJILLO"
# Hay ""
covid_ind$ORIGEN_NACIONAL[covid_ind$ORIGEN_NACIONAL == ""] <- NA
## Double check "" and count NAs
unique(covid_ind$CASO_ID)
sum(is.na(covid_ind$CASO_ID)) # 1713 NAs
unique(covid_ind$FECHA)
sum(is.na(covid_ind$FECHA)) # 0 NAs
unique(covid_ind$DIA)
sum(is.na(covid_ind$DIA)) # 0 NAs
unique(covid_ind$MES)
sum(is.na(covid_ind$MES)) # 0 NAs
unique(covid_ind$ANO)
sum(is.na(covid_ind$ANO)) # 0 NAs
unique(covid_ind$REGION)
sum(is.na(covid_ind$REGION)) # 0 NAs
unique(covid_ind$PROVINCIA)
sum(is.na(covid_ind$PROVINCIA)) # 1356 NAs
unique(covid_ind$DISTRITO)
sum(is.na(covid_ind$DISTRITO)) # 1471 NAs
unique(covid_ind$EDAD_A_n)
sum(is.na(covid_ind$EDAD_A_n)) # 1555 NAs
unique(covid_ind$SEXOM1H0)
sum(is.na(covid_ind$SEXOM1H0)) # 1512 NAs
unique(covid_ind$HOSPITALIZADOS1N0)
sum(is.na(covid_ind$HOSPITALIZADOS1N0)) # 1544 NAs
unique(covid_ind$AISLADODOMICILS1N0)
sum(is.na(covid_ind$AISLADODOMICILS1N0)) # 1545 NAs
unique(covid_ind$CONTACTO)
sum(is.na(covid_ind$CONTACTO)) # 1576 NAs
unique(covid_ind$IMPORTADO)
sum(is.na(covid_ind$IMPORTADO)) # 1712 NAs
unique(covid_ind$CASO_CONTACTO)
sum(is.na(covid_ind$CASO_CONTACTO)) #  1577 NAs
unique(covid_ind$RELACION_CONTACTO)
sum(is.na(covid_ind$RELACION_CONTACTO)) #  1729 NAs
unique(covid_ind$ORIGEN_NACIONAL)
sum(is.na(covid_ind$ORIGEN_NACIONAL)) # 1712 NAs
# Save dataset
names(covid_ind)
covid_ind <- covid_ind[,c(1:10,24,11:23)]
names(covid_ind)
# Save csv.
# CAMBIA EL NOMBRE! NO TE OLVIDES!
#write.csv(covid_ind, "data/modificadas/covidPE_IND_20200403_MD_clean.csv")
#write.csv(covid_ind, "data/modificadas/covidPE_IND_20200404_MD_clean.csv")
#write.csv(covid_ind, "data/modificadas/covidPE_IND_20200405_CA_clean.csv")
write.csv(covid_ind, "data/modificadas/covidPE_IND_20200406_CA_clean.csv")
