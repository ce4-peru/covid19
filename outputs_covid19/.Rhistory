data2018II <- data2018II[grepl("Participa",data2018II$VIVIENDA_ESTADO),]
data2019 <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019VANCAN_CLEAN_2019-12-10.csv", stringsAsFactors = FALSE)
data2019 <- data2019[!duplicated(data2019$VIVIENDA_UNICODE),]
data2019DCE <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019DCE_CLEAN_2019-11-04.csv", stringsAsFactors = FALSE)
data2019DCE <- data2019DCE[!duplicated(data2019DCE$VIVIENDA_UNICODE),]
total_data_2019 <- rbind(data2019[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2019DCE[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")])
total_data_2019  <- total_data_2019[!duplicated(total_data_2019$VIVIENDA_UNICODE),]
#F     M    <NA>
#4581  2760   69
table(total_data$VIVIENDA_GENERO_ENCUESTADO, useNA = "ifany")
#F     M    <NA>
#4581  2760   69
table(total_data_2019$VIVIENDA_GENERO_ENCUESTADO, useNA = "ifany")
data2016 <- read.csv("~/Rabies/rabia_ASA_encuesta_2016/resultados/RESULT_MATCH_ENCUESTAS_ASA_JUN_2017.csv", stringsAsFactors = FALSE)
data2016 <- data2016[-4371,]
data2017 <- read.csv("~/Rabies/rabia_ASA_encuesta_2017/resultados/TABLA_VIVIENDA_2017_clean2018-02-14.csv", stringsAsFactors = FALSE)
data2018 <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_CLEAN_2018-09-20.csv", stringsAsFactors = FALSE)
data2018II <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_II_CLEAN_2018-12-06.csv", stringsAsFactors = FALSE)
data2018II <- data2018II[grepl("Participa",data2018II$VIVIENDA_ESTADO),]
data2019 <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019VANCAN_CLEAN_2019-12-10.csv", stringsAsFactors = FALSE)
data2019 <- data2019[!duplicated(data2019$VIVIENDA_UNICODE),]
data2019DCE <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019DCE_CLEAN_2019-11-04.csv", stringsAsFactors = FALSE)
data2019DCE <- data2019DCE[!duplicated(data2019DCE$VIVIENDA_UNICODE),]
data2016 <- read.csv("~/Rabies/rabia_ASA_encuesta_2016/resultados/RESULT_MATCH_ENCUESTAS_ASA_JUN_2017.csv", stringsAsFactors = FALSE)
data2016 <- data2016[-4371,]
data2017 <- read.csv("~/Rabies/rabia_ASA_encuesta_2017/resultados/TABLA_VIVIENDA_2017_clean2018-02-14.csv", stringsAsFactors = FALSE)
data2018 <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_CLEAN_2018-09-20.csv", stringsAsFactors = FALSE)
data2018II <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_II_CLEAN_2018-12-06.csv", stringsAsFactors = FALSE)
data2018II <- data2018II[grepl("Participa",data2018II$VIVIENDA_ESTADO),]
data2019 <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019VANCAN_CLEAN_2019-12-10.csv", stringsAsFactors = FALSE)
data2019 <- data2019[!duplicated(data2019$VIVIENDA_UNICODE),]
data2019DCE <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019DCE_CLEAN_2019-11-04.csv", stringsAsFactors = FALSE)
data2019DCE <- data2019DCE[!duplicated(data2019DCE$VIVIENDA_UNICODE),]
data2016 <- data2016[,c("UNICODE", "GENERO")]
colnames(data2016) <- c("VIVIENDA_UNICODE","VIVIENDA_GENERO_ENCUESTADO")
data2018II$VIVIENDA_GENERO_ENCUESTADO  <- unlist(NA)
total_data_VANCAN <- rbind(data2016[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2017[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2018[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2018II[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2019[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")])
total_data_DCE <- data2019DCE[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")]
total_data_VANCAN <- total_data_VANCAN[!duplicated(total_data_VANCAN$VIVIENDA_UNICODE),]
total_data_DCE <- total_data_DCE[!duplicated(total_data_DCE$VIVIENDA_UNICODE),]
# F     M     <NA>
# 1833  1046    1
table(total_data_VANCAN$VIVIENDA_GENERO_ENCUESTADO, useNA = "ifany")
# F     M     <NA>
# 4271 2549   69
table(total_data_DCE$VIVIENDA_GENERO_ENCUESTADO, useNA = "ifany")
data2016 <- read.csv("~/Rabies/rabia_ASA_encuesta_2016/resultados/RESULT_MATCH_ENCUESTAS_ASA_JUN_2017.csv", stringsAsFactors = FALSE)
data2016 <- data2016[-4371,]
data2017 <- read.csv("~/Rabies/rabia_ASA_encuesta_2017/resultados/TABLA_VIVIENDA_2017_clean2018-02-14.csv", stringsAsFactors = FALSE)
data2018 <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_CLEAN_2018-09-20.csv", stringsAsFactors = FALSE)
data2018II <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_II_CLEAN_2018-12-06.csv", stringsAsFactors = FALSE)
data2018II <- data2018II[grepl("Participa",data2018II$VIVIENDA_ESTADO),]
data2019 <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019VANCAN_CLEAN_2019-12-10.csv", stringsAsFactors = FALSE)
data2019 <- data2019[!duplicated(data2019$VIVIENDA_UNICODE),]
data2019DCE <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019DCE_CLEAN_2019-11-04.csv", stringsAsFactors = FALSE)
data2019DCE <- data2019DCE[!duplicated(data2019DCE$VIVIENDA_UNICODE),]
View(data2019)
View(data2019DCE)
data2016 <- read.csv("~/Rabies/rabia_ASA_encuesta_2016/resultados/RESULT_MATCH_ENCUESTAS_ASA_JUN_2017.csv", stringsAsFactors = FALSE)
data2016 <- data2016[-4371,]
data2017 <- read.csv("~/Rabies/rabia_ASA_encuesta_2017/resultados/TABLA_VIVIENDA_2017_clean2018-02-14.csv", stringsAsFactors = FALSE)
data2018 <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_CLEAN_2018-09-20.csv", stringsAsFactors = FALSE)
data2018II <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_II_CLEAN_2018-12-06.csv", stringsAsFactors = FALSE)
data2018II <- data2018II[grepl("Participa",data2018II$VIVIENDA_ESTADO),]
data2019 <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019VANCAN_CLEAN_2019-12-10.csv", stringsAsFactors = FALSE)
data2019 <- data2019[!duplicated(data2019$VIVIENDA_UNICODE),]
data2019DCE <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019DCE_CLEAN_2019-11-04.csv", stringsAsFactors = FALSE)
data2019DCE <- data2019DCE[!duplicated(data2019DCE$VIVIENDA_UNICODE),]
#setwd("~/Rabies/shiny-rabia-2019/")
#source("loadSaveMethods.R")
#source("global.R")
data2016 <- read.csv("~/Rabies/rabia_ASA_encuesta_2016/resultados/RESULT_MATCH_ENCUESTAS_ASA_JUN_2017.csv", stringsAsFactors = FALSE)
data2016 <- data2016[-4371,]
data2017 <- read.csv("~/Rabies/rabia_ASA_encuesta_2017/resultados/TABLA_VIVIENDA_2017_clean2018-02-14.csv", stringsAsFactors = FALSE)
data2018 <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_CLEAN_2018-09-20.csv", stringsAsFactors = FALSE)
data2018II <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_II_CLEAN_2018-12-06.csv", stringsAsFactors = FALSE)
data2018II <- data2018II[grepl("Participa",data2018II$VIVIENDA_ESTADO),]
data2019 <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019VANCAN_CLEAN_2019-12-10.csv", stringsAsFactors = FALSE)
data2019 <- data2019[!duplicated(data2019$VIVIENDA_UNICODE),]
data2019DCE <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019DCE_CLEAN_2019-11-04.csv", stringsAsFactors = FALSE)
data2019DCE <- data2019DCE[!duplicated(data2019DCE$VIVIENDA_UNICODE),]
total <-rbind(data2019[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")],data2019DCE[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")])
View(total)
total <- total[!duplicated(total$VIVIENDA_UNICODE),]
data2016 <- read.csv("~/Rabies/rabia_ASA_encuesta_2016/resultados/RESULT_MATCH_ENCUESTAS_ASA_JUN_2017.csv", stringsAsFactors = FALSE)
data2016 <- data2016[-4371,]
data2017 <- read.csv("~/Rabies/rabia_ASA_encuesta_2017/resultados/TABLA_VIVIENDA_2017_clean2018-02-14.csv", stringsAsFactors = FALSE)
data2018 <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_CLEAN_2018-09-20.csv", stringsAsFactors = FALSE)
data2018II <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_II_CLEAN_2018-12-06.csv", stringsAsFactors = FALSE)
data2018II <- data2018II[grepl("Participa",data2018II$VIVIENDA_ESTADO),]
data2019 <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019VANCAN_CLEAN_2019-12-10.csv", stringsAsFactors = FALSE)
data2019 <- data2019[!duplicated(data2019$VIVIENDA_UNICODE),]
data2019DCE <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019DCE_CLEAN_2019-11-04.csv", stringsAsFactors = FALSE)
data2019DCE <- data2019DCE[!duplicated(data2019DCE$VIVIENDA_UNICODE),]
data2016 <- data2016[,c("UNICODE", "GENERO")]
colnames(data2016) <- c("VIVIENDA_UNICODE","VIVIENDA_GENERO_ENCUESTADO")
data2018II$VIVIENDA_GENERO_ENCUESTADO  <- unlist(NA)
total_data <- rbind(data2016[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2017[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2018[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2018II[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2019[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2019DCE[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")])
total_data_2019 <- rbind(data2019[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2019DCE[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")])
total_data_VANCAN <- rbind(data2016[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2017[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2018[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2018II[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")], data2019[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")])
total_data_DCE <- data2019DCE[,c("VIVIENDA_UNICODE", "VIVIENDA_GENERO_ENCUESTADO")]
#Obtener solo la primera visita
total_data  <- total_data[!duplicated(total_data$VIVIENDA_UNICODE),]
total_data_2019  <- total_data_2019[!duplicated(total_data_2019$VIVIENDA_UNICODE),]
total_data_VANCAN <- total_data_VANCAN[!duplicated(total_data_VANCAN$VIVIENDA_UNICODE),]
total_data_DCE <- total_data_DCE[!duplicated(total_data_DCE$VIVIENDA_UNICODE),]
# F     M     <NA>
# 4271 2549   69
table(total_data_DCE$VIVIENDA_GENERO_ENCUESTADO, useNA = "ifany")
total_data_DCE[is.na(total_data_DCE$VIVIENDA_GENERO_ENCUESTADO),]
data2019DCE[data2019DCE$VIVIENDA_UNICODE=="1.1.27.196",]
aux  <- data2019DCE[data2019DCE$VIVIENDA_UNICODE=="1.1.27.196",]
View(aux)
data2016 <- read.csv("~/Rabies/rabia_ASA_encuesta_2016/resultados/RESULT_MATCH_ENCUESTAS_ASA_JUN_2017.csv", stringsAsFactors = FALSE)
data2016 <- data2016[-4371,]
data2017 <- read.csv("~/Rabies/rabia_ASA_encuesta_2017/resultados/TABLA_VIVIENDA_2017_clean2018-02-14.csv", stringsAsFactors = FALSE)
data2018 <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_CLEAN_2018-09-20.csv", stringsAsFactors = FALSE)
data2018II <- read.csv("~/Rabies/rabia_ASA_encuesta_2018/resultados/VIVIENDA_II_CLEAN_2018-12-06.csv", stringsAsFactors = FALSE)
data2018II <- data2018II[grepl("Participa",data2018II$VIVIENDA_ESTADO),]
data2019 <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019VANCAN_CLEAN_2019-12-10.csv", stringsAsFactors = FALSE)
data2019 <- data2019[!duplicated(data2019$VIVIENDA_UNICODE),]
data2019DCE <- read.csv("~/Rabies/rabia_ASA_encuesta_2019/resultados/VIVIENDA2019DCE_CLEAN_2019-11-04.csv", stringsAsFactors = FALSE)
data2019DCE <- data2019DCE[!duplicated(data2019DCE$VIVIENDA_UNICODE),]
data2019DCE$ANIO2019DCE <- unlist(1)
data2019DCE <- data2019DCE[,c("VIVIENDA_UNICODE", "ANIO2019DCE", "VIVIENDA_GENERO_ENCUESTADO")]
data2016$ANIO2016 <- unlist(1)
data2016 <- data2016[,c("UNICODE", "ANIO2016")]
colnames(data2016) <- c("VIVIENDA_UNICODE", "ANIO2016")
data2017$ANIO2017 <- unlist(1)
data2017 <- data2017[,c("VIVIENDA_UNICODE", "ANIO2017")]
data2018$ANIO2018 <- unlist(1)
data2018 <- data2018[,c("VIVIENDA_UNICODE", "ANIO2018")]
data2018II$ANIO2018II <- unlist(1)
data2018II <- data2018II[,c("VIVIENDA_UNICODE", "ANIO2018II")]
data2019$ANIO2019 <- unlist(1)
data2019 <- data2019[,c("VIVIENDA_UNICODE", "ANIO2019")]
data <- merge(data2016, data2017, all=TRUE)
new2017 <- data[is.na(data$ANIO2016),]
data <- merge(data, data2018, all=TRUE)
new2018 <- data[is.na(data$ANIO2016) & is.na(data$ANIO2017),]
data <- merge(data, data2018II, all=TRUE)
new2018II <- data[is.na(data$ANIO2016) & is.na(data$ANIO2017) & is.na(data$ANIO2018),]
#Aqui ejecutar uno independiente del otro
dataVancan <- merge(data, data2019, all=TRUE)
new2019 <- dataVancan[is.na(dataVancan$ANIO2016) & is.na(dataVancan$ANIO2017) & is.na(dataVancan$ANIO2018) & is.na(dataVancan$ANIO2018II),]
dataDCE <- merge(data, data2019DCE, all=TRUE)
new2019DCE <- dataDCE[is.na(dataDCE$ANIO2016) & is.na(dataDCE$ANIO2017) & is.na(dataDCE$ANIO2018) & is.na(dataDCE$ANIO2018II),]
table(new2019DCE$VIVIENDA_GENERO_ENCUESTADO, useNA = "ifany")
View(new2019DCE)
View(new2019)
library(data.table)
library(dplyr)
library(tidyr)
library(tidyverse)
library(lubridate)
## set directory
setwd("~/covid19")
## Call data
#covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200403_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200404_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200405_CA.csv")
#covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200406_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200407_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200408_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200409_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200410_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200411_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200412_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200413_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200414_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200415_GF.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200416_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200417_AL.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200418_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200419_GF.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200420_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200421_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200422_GF.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200423_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200416_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200417_AL.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200418_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200419_GF.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200420_MD.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200421_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200422_GF.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200423_CA.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200424_AL.csv")
# covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200425_MD.csv")
covid_dia <- fread("~/covid19/data/crudas/covidPE_pordia_20200426_GF.csv")
## Checar base
str(covid_dia) # 51 obs. of  14 variables
names(covid_dia)
head(covid_dia)
covid_dia <- mutate_if(covid_dia, is.character, toupper)
sapply(covid_dia, class)
# FECHA    TOTAL_POSITIVOS      TOTAL_PRUEBAS  TOTAL_DESCARTADOS
# "character"          "integer"          "integer"          "integer"
# POSITIVOS_DIA        PRUEBAS_DIA    DESCARTADOS_DIA        RECUPERADOS
# "integer"          "integer"          "integer"          "integer"
# FALLECIDOS     HOSPITALIZADOS HOSPITALIZADOS_UCI        OBSERVACION
# "integer"          "integer"          "integer"        "character"
# FUENTE      ACTUALIZACION
# "character"        "character"
### variable by variable
### Fecha ####
table(covid_dia$FECHA)
# 01/04/2020 02/04/2020 03/04/2020 04/04/2020 05/04/2020 06/03/2020 06/04/2020 07/03/2020
# 1          1          1          1          1          1          1          1
# 07/04/2020 08/03/2020 08/04/2020 09/03/2020 09/04/2020 10/03/2020 10/04/2020 11/03/2020
# 1          1          1          1          1          1          1          1
# 11/04/2020 12/03/2020 12/04/2020 13/03/2020 13/04/2020 14/03/2020 14/04/2020 15/03/2020
# 1          1          1          1          1          1          1          1
# 15/04/2020 16/03/2020 16/04/2020 17/03/2020 17/04/2020 18/03/2020 18/04/2020 19/03/2020
# 1          1          1          1          1          1          1          1
# 19/04/2020 20/03/2020 20/04/2020 21/03/2020 21/04/2020 22/03/2020 22/04/2020 23/03/2020
# 1          1          1          1          1          1          1          1
# 23/04/2020 24/03/2020 24/04/2020 25/03/2020 26/03/2020 27/03/2020 28/03/2020 29/03/2020
# 1          1          1          1          1          1          1          1
# 30/03/2020 31/03/2020
# 1          1
#### separando caracteres en varias columnas ######
covid_dia$FECHA2 <- covid_dia$FECHA
covid_dia <- separate(covid_dia,
col = "FECHA2",
into = c("DIA", "MES","ANO"),
sep = "/")
##### fecha to as.date format ####
covid_dia<-covid_dia %>%
mutate(FECHA = as.Date(as.character(FECHA), format = "%d/%m/%y"))
### ordenar base ###
names(covid_dia)
# [1] "FECHA"              "TOTAL_POSITIVOS"    "TOTAL_PRUEBAS"      "TOTAL_DESCARTADOS"
# [5] "POSITIVOS_DIA"      "PRUEBAS_DIA"        "DESCARTADOS_DIA"    "RECUPERADOS"
# [9] "FALLECIDOS"         "HOSPITALIZADOS"     "HOSPITALIZADOS_UCI" "OBSERVACION"
# [13] "FUENTE"             "ACTUALIZACION"      "DIA"                "MES"
# [17] "ANO"
covid_dia <- covid_dia[,c(1, 15:17, 2:14)]
### Check NAs and inconsistencies ###
## Fecha
str(covid_dia$FECHA) # date
unique(covid_dia$FECHA)
sum(is.na(covid_dia$FECHA)) # 0 NAs
unique(covid_dia$TOTAL_POSITIVOS)
sum(is.na(covid_dia$TOTAL_POSITIVOS)) # 0 NAs
unique(covid_dia$TOTAL_PRUEBAS)
sum(is.na(covid_dia$TOTAL_PRUEBAS)) # 0 NAs
unique(covid_dia$TOTAL_DESCARTADOS)
sum(is.na(covid_dia$TOTAL_DESCARTADOS)) # 0 NAs
unique(covid_dia$POSITIVOS_DIA)
sum(is.na(covid_dia$POSITIVOS_DIA)) # 0 NAs
unique(covid_dia$PRUEBAS_DIA)
sum(is.na(covid_dia$PRUEBAS_DIA)) # 0 NAs
unique(covid_dia$DESCARTADOS_DIA)
sum(is.na(covid_dia$DESCARTADOS_DIA)) # 0
unique(covid_dia$RECUPERADOS)
sum(is.na(covid_dia$RECUPERADOS)) # 9 NAs
unique(covid_dia$FALLECIDOS)
sum(is.na(covid_dia$FALLECIDOS)) # 12 NAs
unique(covid_dia$HOSPITALIZADOS)
sum(is.na(covid_dia$HOSPITALIZADOS)) # 12 NAs
unique(covid_dia$HOSPITALIZADOS_UCI)
sum(is.na(covid_dia$HOSPITALIZADOS_UCI)) # 19 NAs
# unique(covid_dia$HOSPITALIZADOS_VENTILADOR)
# sum(is.na(covid_dia$HOSPITALIZADOS_VENTILADOR)) # 22 NAs
names(covid_dia)
# [1] "FECHA"              "DIA"                "MES"                "ANO"
# [5] "TOTAL_POSITIVOS"    "TOTAL_PRUEBAS"      "TOTAL_DESCARTADOS"  "POSITIVOS_DIA"
# [9] "PRUEBAS_DIA"        "DESCARTADOS_DIA"    "RECUPERADOS"        "FALLECIDOS"
# [13] "HOSPITALIZADOS"     "HOSPITALIZADOS_UCI" "OBSERVACION"        "FUENTE"
# [17] "ACTUALIZACION"
# Save csv.
# CAMBIA EL NOMBRE! NO TE OLVIDES!
write.csv(covid_dia, "data/modificadas/covidPE_PORdia_20200426_GF_clean.csv")
ary(data.table)
library(dplyr)
library(tidyr)
library(tidyverse)
library(lubridate)
## set directory
setwd("~/covid19")
## Call data
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200412_MD.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200413_CA.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200414_CA.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200415_GF.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200416_CA.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200417_AL.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200418_MD.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200419_GF.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200420_MD.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200421_CA.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200422_GF.csv")
# covid_dep
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200416_CA.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200417_AL.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200418_MD.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200419_GF.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200420_MD.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200421_CA.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200422_GF.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200423_CA.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200424_AL.csv")
# covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200425_MD.csv")
covid_dep <- fread("~/covid19/data/crudas/covidPE_DEP_20200426_GF.csv")
str(covid_dep) # 52 obs. of  31 variables
names(covid_dep)
# [1] "Día"         "Fecha"       "LIM"         "ARE"         "HUC"         "ICA"
# [7] "CUS"         "PIU"         "LAM"         "CAL"         "LAL"         "ANC"
# [13] "LOR"         "SAM"         "MDD"         "JUN"         "TUM"         "CAJ"
# [19] "PAS"         "TAC"         "AYA"         "HUA"         "APU"         "MOQ"
# [25] "PUN"         "AMA"         "UCA"         "Total"       "Acumulado"   "Descartados"
# [31] "Fuente"
# >
# Eliminar columnas y filas
#Recuerde aqui quitar la ultima columna y las columna y fila de "totales"
# Ma?ana 27 hay que sacar la fila 53.
# Dia 26/04 se sac[o] la fila 52.
covid_dep <- covid_dep[-52,-c(1,28:31)] #OJO
View(covid_dep)
head(covid_dep)
# Transformar todo texto a mayusculas
# Transform to character
# No me sale
covid_dep <- mutate_if(covid_dep, is.character, toupper)
sapply(covid_dep, class)
# Fecha         LIM         ARE         HUC         ICA         CUS         PIU
# "character"   "integer"   "integer"   "integer"   "integer"   "integer"   "integer"
# LAM         CAL         LAL         ANC         LOR         SAM         MDD
# "integer"   "integer"   "integer"   "integer"   "integer"   "integer"   "integer"
# JUN         TUM         CAJ         PAS         TAC         AYA         HUA
# "integer"   "integer"   "integer"   "integer"   "integer"   "integer"   "integer"
# APU         MOQ         PUN         AMA         UCA
# "integer"   "integer"   "integer"   "integer"   "integer"
# >
### variableby variable
table(covid_dep$Fecha)
# 01/04/2020 02/04/2020 03/04/2020 04/04/2020 05/04/2020 06/03/2020 06/04/2020 07/03/2020
# 1          1          1          1          1          1          1          1
# 07/04/2020 08/03/2020 08/04/2020 09/03/2020 09/04/2020 10/03/2020 10/04/2020 11/03/2020
# 1          1          1          1          1          1          1          1
# 11/04/2020 12/03/2020 12/04/2020 13/03/2020 13/04/2020 14/03/2020 14/04/2020 15/03/2020
# 1          1          1          1          1          1          1          1
# 15/04/2020 16/03/2020 16/04/2020 17/03/2020 17/04/2020 18/03/2020 18/04/2020 19/03/2020
# 1          1          1          1          1          1          1          1
# 19/04/2020 20/03/2020 20/04/2020 21/03/2020 21/04/2020 22/03/2020 22/04/2020 23/03/2020
# 1          1          1          1          1          1          1          1
# 23/04/2020 24/03/2020 24/04/2020 25/03/2020 26/03/2020 27/03/2020 28/03/2020 29/03/2020
# 1          1          1          1          1          1          1          1
# 30/03/2020 31/03/2020
# 1          1
# # 1
#### separando caracteres en varias columnas ######
# covid_ind$FECHA2 <- covid_ind$FECHA
# covid_ind <- separate(covid_ind,
#          col = "FECHA2",
#          into = c("DIA", "MES","ANO"),
#          sep = "/")
# ##### fecha to as.date format ####
covid_dep<-covid_dep %>%
mutate(Fecha1 = as.Date(as.character(Fecha), format = "%d/%m/%y"))
### ordenar base ###
names(covid_dep)
#  [1] "Fecha"  "LIM"    "ARE"    "HUC"    "ICA"    "CUS"    "PIU"    "LAM"    "CAL"
#  [10] "LAL"    "ANC"    "LOR"    "SAM"    "MDD"    "JUN"    "TUM"    "CAJ"    "PAS"
#  [19] "TAC"    "AYA"    "HUA"    "APU"    "MOQ"    "PUN"    "AMA"    "UCA"    "Fecha1"
# #
# covid_dep <- covid_dep[,c(1, 2, 21:23, 3:20)]
covid_dep<- covid_dep%>%
select(-Fecha)
# Tidy data to work with it
covid_dep2 <- gather(covid_dep,
key = "REGION",
value = "CASOS",
-Fecha1)
covid_dep2
covid_dep2$CASOS[is.na(covid_dep2$CASOS)] <- 0
# Save csv.
# CAMBIA EL NOMBRE! NO TE OLVIDES!
# write.csv(covid_dep2, "data/modificadas/covidPE_IND_20200412_MD_clean.csv")
#write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200413_CA_clean.csv", row.names = FALSE)
#write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200414_CA_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200415_GF_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200417_AL_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200418_MD_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200419_GF_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200420_MD_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200421_CA_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200422_GF_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200423_CA_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200424_AL_clean.csv", row.names = FA
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200415_GF_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200417_AL_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200418_MD_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200419_GF_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200420_MD_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200421_CA_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200422_GF_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200423_CA_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200424_AL_clean.csv", row.names = FALSE)
# write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200425_MD_clean.csv", row.names = FALSE)
write.csv(covid_dep2, "data/modificadas/covidPE_DEP_20200426_GF_clean.csv", row.names = FALSE)
library(data.table)
library(dplyr)
library(tidyr)
# library(tidyverse)
library(lubridate)
library(ggplot2)
library(directlabels)
library(reshape)
library(colorspace)
library(plotly)
#### si no tienes el paquete bbplot
library(devtools)
library(rlang)
library(digest)
library(glue)
# install devtools
library(devtools)
#devtools::install_github('bbc/bbplot')
#devtools::install_github('JLutils')# Esto no va a funcionar
#install.packages('JLutils', repos = 'https://cloud.r-project.org')
library(bbplot)
#library(bbc)# Me parece que esta libreria esta por las puras
#library(JLutils)
library(scales)
library("gridExtra")
library(cowplot)
######### curvas nacionales de positivos y pruebas totales ##################
### leer esta data de los puntos de corte para ambos dibujos ####
d=data.frame(Fecha=as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15","2020-03-16", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")), event=c(" Primer Caso", " Cierre colegios", "Cierre universidades", " Inicio de cuarentena","Cierre de aeropuertos", " Extensión cuarentena", " Restricción por sexo","Toque de queda 18pm-5am","Extensión cuarentena"))
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200406_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200407_CA_clean.csv.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200410_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200411_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200412_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200413_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200414_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200415_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200416_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200418_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200419_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200420_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200421_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200414_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200415_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200416_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200418_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200419_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200420_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200421_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200422_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200423_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200424_AL_clean.csv")
acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200426_GF_clean.csv")
setnames(acumulado,"TOTAL_POSITIVOS","Casos positivos")
setnames(acumulado,"TOTAL_PRUEBAS","Pruebas realizadas")
acumulado1<-melt(acumulado,id="FECHA")
acumulado1$value<-as.numeric(acumulado1$value)
target <- c("Casos positivos", "Pruebas realizadas")
acumulado1<-filter(acumulado1, variable %in% target)
acumulado1<-acumulado1 %>%
mutate(Fecha = as.Date(FECHA))
setwd("~/covid19/outputs_covid19/")
#
png(filename="20200426_pruebas_vs_positivos_COVID19.png", width=1100, height=600)
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),
breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12",
"2020-03-15","2020-03-16" ,"2020-03-26","2020-03-31",
"2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en Perú", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )+
bbc_style()
#print(p)
dev.off()
library(ggplot2)
library(ggmap)
library(data.table)
library(maptools)
library(rgeos)
library(Cairo)
library(scales)
library(RColorBrewer)
library(rgdal)
library(sp)
library(plyr)
library(tmap)
library(ggplot2)
library(ggmap)
library(data.table)
library(maptools)
library(rgeos)
library(Cairo)
library(scales)
library(RColorBrewer)
library(rgdal)
library(sp)
library(plyr)
library(tmap)
