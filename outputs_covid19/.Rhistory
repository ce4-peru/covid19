<<<<<<< HEAD
"LAL"= "LA LIBERTAD",
"LAM"="LAMBAYEQUE",
"LIM"="LIMA",
"LOR"="LORETO",
"MDD"="MADRE DE DIOS",
"PAS"="PASCO",
"PIU"="PIURA",
"SAM"="SAN MARTIN",
"TAC"="TACNA",
"TUM"="TUMBES",
"AMA"="AMAZONAS",
"MOQ"="MOQUEGUA",
"APU"="APURIMAC",
"HUA"="HUANCAVELICA",
"PUN"="PUNO",
"UCA"="UCAYALI"))
## Checar csv de poblaciones regionales
names(pob_region) # "REGION"    "POBLACION"
pob_region[[1]] <- toupper(pob_region[[1]])
unique(pob_region$REGION) # todo ok
## Merge cases with populations
region_values <- merge(casos_region, pob_region, by="REGION",
all.x=T, all.y=T)
## Calcula incidencias
region_values$NUMERO_CASOS <- as.numeric(region_values$NUMERO_CASOS)
region_values$POBLACION <- as.numeric(as.character(region_values$POBLACION))
region_values$incidencia <- region_values$NUMERO_CASOS/region_values$POBLACION
options(digits = 2)
region_values$incidencerate_100 <-(region_values$incidencia*100000)
## recode the names of the region_values data frame
setnames(region_values, old = "REGION",new = "NAME_1")
levels(region_values$NAME_1)
View(region_values)
## Create labels that does not occupy
region_values <- region_values[,-2]
region_values$NAME_LABEL <- region_values$NAME_1
str(region_values$NAME_LABEL)
region_values$NAME_LABEL <- revalue(region_values$NAME_LABEL,
c("ANCASH"="ANC",
"AREQUIPA"="AQP",
"AYACUCHO" ="AYA",
"CAJAMARCA"="CAJ",
"CALLAO"="CAL",
"CUSCO" ="CUS",
"HUANUCO" ="HCO",
"ICA" ="ICA",
"JUNIN" ="JUN",
"LA LIBERTAD" ="LAL",
"LAMBAYEQUE" ="LAM",
"LIMA" ="LIM",
"LORETO"="LOR",
"MADRE DE DIOS"="MDD",
"PASCO" ="PAS",
"PIURA"="PIU",
"SAN MARTIN"="SAM",
"TACNA" ="TAC",
"TUMBES" ="TUM",
"AMAZONAS" ="AMA",
"MOQUEGUA"="MOQ",
"APURIMAC"="APU",
"HUANCAVELICA"="HUV",
"PUNO"="PUN",
"UCAYALI"="UCA"))
## Merge data with shapefile
tmp1 <- sh_peru
tmp1_map <- tmp1
tmp1_map@data <- join(sh_peru@data,region_values, by="NAME_1") # shp with data
tmp1_map_df <- tmp1_map@data
tmp1_map@data$NUMERO_CASOS[is.na(tmp1_map@data$NUMERO_CASOS)]<-0
tmp1_map@data$incidencia[is.na(tmp1_map@data$incidencia)]<-0
tmp1_map@data$incidencerate_100[is.na(tmp1_map@data$incidencerate_100)]<-0
tmp1_map_df <- tmp1_map@data
tmp1_map@data$brks <- cut(tmp1_map@data$incidencerate_100,
breaks=c(0.0, 1, 2, 5, 10, 20, 40, 100),
labels=c("< 1", "1 a 2",
"2 a 5", "5 a 10", "10 a 20",
#"8 a 10",
"20 a 40", "> 40"))
names(tmp1_map@data) # check variables
tmp1_map_df <- tmp1_map@data
View(tmp1_map_df)
View(tmp1_map_df)
tmp1_map@data$brks <- cut(tmp1_map@data$incidencerate_100,
breaks=c(0.0, 1, 2, 5, 10, 20, 40, 100),
labels=c("< 1", "1 a 2",
"2 a 5", "5 a 10", "10 a 20",
#"8 a 10",
"20 a 50", "> 50"))
names(tmp1_map@data) # check variables
tmp1_map_df <- tmp1_map@data
View(tmp1_map_df)
tmp1_map@data$brks <- cut(tmp1_map@data$incidencerate_100,
breaks=c(0.0, 1, 2, 5, 10, 20, 50, 150),
labels=c("< 1", "1 a 2",
"2 a 5", "5 a 10", "10 a 20",
#"8 a 10",
"20 a 50", "> 50"))
names(tmp1_map@data) # check variables
tmp1_map_df <- tmp1_map@data
# Create the map qtm
col <- c("ivory2", "lightcyan1", "lightblue2",
#"lightskyblue",
"royalblue", "blue2", "navyblue", "black")
# col <- c("ivory2", "lightcyan1", "lightblue2", "lightskyblue",
#           "royalblue", "blue2", "navyblue", "black")
# try snow2 too
# interactive view
#tmap_mode("view")
# crear mapa
qtm <- qtm(tmp1_map, #fill = "incidencerate_100",
fill = "brks",
fill.palette = col,
fill.title="Incidencia por \n100,000 Hab") +
# tm_text("NAME_3", size="0.008", scale=1, root=4,
#         size.lowerbound = .1, bg.color="white", bg.alpha = .15,
#         legend.size.show = FALSE) +
tm_text("NAME_LABEL",size = 0.5)+
tm_layout(paste("Incidencia de \nSARS-CoV2 \nen Peru"), title.size = .92,
legend.title.size = 0.8,
legend.text.size = .6, legend.bg.color = NA,
legend.position = c("left","bottom"),
#outer.margins =c(0.05, 0.05, 0.05, 0.05)
#inner.margins =c(0.05, 0.05, 0.05, 0.05)
title.position = c(.05,.905)) #+ vs5
#tm_view(set.view = c(lon = 15, lat = 48, zoom = 10))
# tm_view(set.view = c(zoom = 10))
print(qtm)
tmap_save(qtm,
paste("outputs_covid19/20200418_Dep_COVID19_Incidencerate",
".png", sep=""),
width=2300, height=1380)
library(data.table)
library(dplyr)
library(tidyr)
# library(tidyverse)
library(lubridate)
library(ggplot2)
library(directlabels)
library(reshape)
library(colorspace)
library(plotly)
library(JLutils)
#### si no tienes el paquete bbplot
# devtools::install_github('bbc/bbplot')
library(bbplot)
library(scales)
library("gridExtra")
library(cowplot)
######### curvas nacionales de positivos y pruebas totales ##################
### leer esta data de los puntos de corte para ambos dibujos ####
d=data.frame(Fecha=as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")), event=c(" Primer Caso", " Cierre colegios", "Cierre universidades", " Inicio de cuarentena", " ExtensiÃ³n cuarentena", " RestricciÃ³n por sexo","Toque de queda 18pm-5am","ExtensiÃ³n cuarentena"))
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200406_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200407_CA_clean.csv.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200410_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200411_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200412_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200413_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200414_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200415_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200416_CA_clean.csv")
acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200418_MD_clean.csv")
setnames(acumulado,"TOTAL_POSITIVOS","Casos positivos")
setnames(acumulado,"TOTAL_PRUEBAS","Pruebas realizadas")
acumulado1<-melt(acumulado,id="FECHA")
acumulado1$value<-as.numeric(acumulado1$value)
target <- c("Casos positivos", "Pruebas realizadas")
acumulado1<-filter(acumulado1, variable %in% target)
acumulado1<-acumulado1 %>%
mutate(Fecha = as.Date(FECHA))
setwd("~/covid19/outputs_covid19/")
png(filename="20200418_pruebas_vs_positivos_COVID19.png", width=1100, height=600)
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en PerÃº", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )+
bbc_style()
# print(p)
dev.off()
#
png(filename="20200418_pruebas_vs_positivos_COVID19.png", width=1100, height=600)
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en PerÃº", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )+
bbc_style()
print(p)
dev.off()
library(data.table)
library(dplyr)
library(tidyr)
# library(tidyverse)
library(lubridate)
library(ggplot2)
library(directlabels)
library(reshape)
library(colorspace)
library(plotly)
library(JLutils)
#### si no tienes el paquete bbplot
# devtools::install_github('bbc/bbplot')
library(bbplot)
library(scales)
library("gridExtra")
library(cowplot)
######### curvas nacionales de positivos y pruebas totales ##################
### leer esta data de los puntos de corte para ambos dibujos ####
d=data.frame(Fecha=as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")), event=c(" Primer Caso", " Cierre colegios", "Cierre universidades", " Inicio de cuarentena", " ExtensiÃ³n cuarentena", " RestricciÃ³n por sexo","Toque de queda 18pm-5am","ExtensiÃ³n cuarentena"))
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200406_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200407_CA_clean.csv.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200410_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200411_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200412_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200413_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200414_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200415_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200416_CA_clean.csv")
acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200418_MD_clean.csv")
setnames(acumulado,"TOTAL_POSITIVOS","Casos positivos")
setnames(acumulado,"TOTAL_PRUEBAS","Pruebas realizadas")
acumulado1<-melt(acumulado,id="FECHA")
acumulado1$value<-as.numeric(acumulado1$value)
target <- c("Casos positivos", "Pruebas realizadas")
acumulado1<-filter(acumulado1, variable %in% target)
acumulado1<-acumulado1 %>%
mutate(Fecha = as.Date(FECHA))
setwd("~/covid19/outputs_covid19/")
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en PerÃº", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )+
bbc_style()
library(data.table)
library(dplyr)
library(tidyr)
# library(tidyverse)
library(lubridate)
library(ggplot2)
library(directlabels)
library(reshape)
library(colorspace)
library(plotly)
library(JLutils)
#### si no tienes el paquete bbplot
# devtools::install_github('bbc/bbplot')
library(bbplot)
library(scales)
library("gridExtra")
library(cowplot)
install.packages("JLutils")
install.packages("bbplot")
library(data.table)
library(dplyr)
library(tidyr)
# library(tidyverse)
library(lubridate)
library(ggplot2)
library(directlabels)
library(reshape)
library(colorspace)
library(plotly)
library(JLutils)
#### si no tienes el paquete bbplot
# devtools::install_github('bbc/bbplot')
library(bbplot)
library(scales)
library("gridExtra")
library(cowplot)
######### curvas nacionales de positivos y pruebas totales ##################
### leer esta data de los puntos de corte para ambos dibujos ####
d=data.frame(Fecha=as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")), event=c(" Primer Caso", " Cierre colegios", "Cierre universidades", " Inicio de cuarentena", " ExtensiÃ³n cuarentena", " RestricciÃ³n por sexo","Toque de queda 18pm-5am","ExtensiÃ³n cuarentena"))
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200406_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200407_CA_clean.csv.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200410_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200411_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200412_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200413_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200414_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200415_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200416_CA_clean.csv")
acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200418_MD_clean.csv")
setnames(acumulado,"TOTAL_POSITIVOS","Casos positivos")
setnames(acumulado,"TOTAL_PRUEBAS","Pruebas realizadas")
acumulado1<-melt(acumulado,id="FECHA")
acumulado1$value<-as.numeric(acumulado1$value)
target <- c("Casos positivos", "Pruebas realizadas")
acumulado1<-filter(acumulado1, variable %in% target)
acumulado1<-acumulado1 %>%
mutate(Fecha = as.Date(FECHA))
setwd("~/covid19/outputs_covid19/")
#
png(filename="20200418_pruebas_vs_positivos_COVID19.png", width=1100, height=600)
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en PerÃº", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )+
bbc_style()
?bbc_style
??bbc_style
png(filename="20200418_pruebas_vs_positivos_COVID19.png", width=1100, height=600)
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en PerÃº", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )#+
#bbc_style()
print(p)
dev.off()
png(filename="20200418_pruebas_vs_positivos_COVID19.png", width=1100, height=600)
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en PerÃº", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )#+
#bbc_style()
#print(p)
dev.off()
png(filename="20200418_pruebas_vs_positivos_COVID19.png", width=1100, height=600)
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en PerÃº", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )+
bbc_style()
#print(p)
dev.off()
#### si no tienes el paquete bbplot
# devtools::install_github('bbc/bbplot')
library(bbplot)
install.packages("bbplot")
#### si no tienes el paquete bbplot
# devtools::install_github('bbc/bbplot')
library(bbplot)
install.packages("bbplot")
devtools::install_github('bbc/bbplot')
install_github('bbc/bbplot')
#### si no tienes el paquete bbplot
devtools::install_github('bbc/bbplot')
install_github('bbc/bbplot')
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
install.packages("devtools")
# library(tidyverse)
library(lubridate)
library(ggplot2)
library(directlabels)
library(reshape)
library(colorspace)
library(plotly)
library(JLutils)
#### si no tienes el paquete bbplot
library(devtools)
install.packages("JLutils")
#### si no tienes el paquete bbplot
library(devtools)
devtools::install_github('bbc/bbplot')
install.packages("rlang")
library(rlang)
devtools::install_github('bbc/bbplot')
library(digest)
install.packages("digest")
library(digest)
devtools::install_github('bbc/bbplot')
install.packages("glue")
library(data.table)
library(dplyr)
library(tidyr)
# library(tidyverse)
library(lubridate)
library(ggplot2)
library(directlabels)
library(reshape)
library(colorspace)
library(plotly)
library(JLutils)
#### si no tienes el paquete bbplot
library(devtools)
library(rlang)
library(digest)
library(glue)
devtools::install_github('bbc/bbplot')
library(scales)
library("gridExtra")
library(cowplot)
######### curvas nacionales de positivos y pruebas totales ##################
### leer esta data de los puntos de corte para ambos dibujos ####
d=data.frame(Fecha=as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")), event=c(" Primer Caso", " Cierre colegios", "Cierre universidades", " Inicio de cuarentena", " ExtensiÃ³n cuarentena", " RestricciÃ³n por sexo","Toque de queda 18pm-5am","ExtensiÃ³n cuarentena"))
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200406_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200407_CA_clean.csv.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200410_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200411_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200412_MD_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200413_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200414_CA_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200415_GF_clean.csv")
# acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200416_CA_clean.csv")
acumulado<-fread("~/covid19/data/modificadas/covidPE_PORdia_20200418_MD_clean.csv")
setnames(acumulado,"TOTAL_POSITIVOS","Casos positivos")
setnames(acumulado,"TOTAL_PRUEBAS","Pruebas realizadas")
acumulado1<-melt(acumulado,id="FECHA")
acumulado1$value<-as.numeric(acumulado1$value)
target <- c("Casos positivos", "Pruebas realizadas")
acumulado1<-filter(acumulado1, variable %in% target)
acumulado1<-acumulado1 %>%
mutate(Fecha = as.Date(FECHA))
setwd("~/covid19/outputs_covid19/")
#
png(filename="20200418_pruebas_vs_positivos_COVID19.png", width=1100, height=600)
ggplot() +
geom_line(data = acumulado1, aes(Fecha, value, colour=variable,group=variable),alpha =1.6) +
scale_colour_manual(values=c("red", "blue"))+
scale_x_date(labels = date_format("%d-%b"),breaks = as.Date(c("2020-03-06", "2020-03-11", "2020-03-12", "2020-03-15", "2020-03-26","2020-03-31","2020-04-02","2020-04-07")),
minor_breaks = NULL)+
# scale_x_date() +
geom_vline(data=d, mapping=aes(xintercept=Fecha), color="gray") +
geom_text(data=d, mapping=aes(x=Fecha, y =0,label=event), size=4, angle=90, vjust=-0.4, hjust=0)+
# theme_minimal()+
theme(panel.background = element_rect(fill = "white"),
legend.position = c(0.35,0.95),
legend.justification = c("right","top"),
axis.text.x = element_text(vjust =0.60,angle=60,face = "bold.italic", size = 10))+
labs(title="SARS-CoV-2 en PerÃº", y="Pruebas positivas y pruebas realizadas",
x="Fecha", caption="Source :varios")+
theme(plot.title = element_text(face = "bold.italic",size = 5) )+
bbc_style()
library(bbc)
library(bbplot)
library(bbc)
install.packages("bbc")
devtools::install_github('bbc')
install.packages("Rtools")
=======
df2$unifecha <- gsub("-12-","12-", df2$unifecha)
df2$unifecha <- gsub("-13-","13-", df2$unifecha)
df2$unifecha <- gsub("-32-","32-", df2$unifecha)
df2$unifecha <- gsub("-34-","34-", df2$unifecha)
df2$unifecha <- gsub("-5-","5-", df2$unifecha)
df2$unifecha <- gsub("-7-","7-", df2$unifecha)
df2$unifecha <- gsub("-14-","14-", df2$unifecha)
df2$unifecha <- gsub("-16-","16-", df2$unifecha)
df2$unifecha <- gsub("-2-","2-", df2$unifecha)
df2$unifecha <- gsub("-206-","206-", df2$unifecha)
df2$unifecha <- gsub("-24-","24-", df2$unifecha)
df2$unifecha <- gsub("-22-","22-", df2$unifecha)
df2$unifecha <- gsub("-21-","21-", df2$unifecha)
df2$unifecha <- gsub("-25-","25-", df2$unifecha)
df2$unifecha <- gsub("-4-","4-", df2$unifecha)
df2$unifecha <- gsub("-6-","6-", df2$unifecha)
df2$unifecha <- gsub("-5-","5-", df2$unifecha)
df2$unifecha <- gsub("-S20-","S20-", df2$unifecha)
df2$unifecha <- gsub("-3-","3-", df2$unifecha)
df2$unifecha <- gsub("-8-","8-", df2$unifecha)
df2$unifecha <- gsub("-319B-","319B-", df2$unifecha)
df2$unifecha <- gsub("-319B-","319B-", df2$unifecha)
df2$unifecha <- gsub("-101-","101-", df2$unifecha)
df2$unifecha <- gsub("-102-","102-", df2$unifecha)
df2$unifecha <- gsub("-103-","103-", df2$unifecha)
df2$unifecha <- gsub("-104-","104-", df2$unifecha)
df2$unifecha <- gsub("-106-","106-", df2$unifecha)
df2$unifecha <- gsub("-201-","201-", df2$unifecha)
df2$unifecha <- gsub("-203-","203-", df2$unifecha)
df2$unifecha <- gsub("-208-","208-", df2$unifecha)
df2$unifecha <- gsub("-400-","400-", df2$unifecha)
df2$unifecha <- gsub("-402-","402-", df2$unifecha)
df2$unifecha <- gsub("-30-","30-", df2$unifecha)
df2$unifecha <- gsub("-19-","19-", df2$unifecha)
df2$unifecha <- gsub("-9-","9-", df2$unifecha)
View(df2)
df2<- df2%>%select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen,num_camas,count)
df2<-tidyr::separate(df2,col="unifecha",into=c("UNICODE","FECHA"),sep="-")
df2<-df2 %>% mutate(FECHA = as.Date(as.character(FECHA),format = "%d/%m/%Y"))
df2$FECHA<- gsub("-","/", df2$FECHA)
df2= mutate ( df2,unifecha=paste(UNICODE,FECHA,sep ="-" ))
df2<-df2 %>% rename_all(tolower)
df2 <- mutate_if(df2, is.character, toupper)
View(df2)
df2<- df2%>%
select(codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen,num_camas,count,unifecha)
df2<-aggregate(count~unifecha+mascotas_cuarto,data = df2,FUN = sum)
View(df2)
df_mascotas<-dcast(df2,unifecha~mascotas_cuarto )
View(df_mascotas)
df_mascotas$unifecha <- gsub("1.10.2.1009-2017/09/15","1.10.2.1009-2017/10/18", df_mascotas$unifecha)
setnames(df_mascotas,"GATO","HAB_GATO")
setnames(df_mascotas,"GATO/ POLLO","HAB_GATO_POLLO")
setnames(df_mascotas,"PERRO","HAB_PERRO")
aux<- merge(df_total, df_mascotas,by="unifecha",all.x = TRUE)
a1<-anti_join(df_total,df_mascotas)
b1<-semi_join(df_total,df_mascotas)
View(a1)
df2<-fread("~/cimex_aqp/match/CHINCHES CSV/resultado/archivos_resultado_2020/result_match_cuarto_final.csv")
df2$count<-unlist(1)
#
df2$unifecha <- gsub("-1-","1-", df2$unifecha)
df2$unifecha <- gsub("-10-","10-", df2$unifecha)
df2$unifecha <- gsub("-12-","12-", df2$unifecha)
df2$unifecha <- gsub("-13-","13-", df2$unifecha)
df2$unifecha <- gsub("-32-","32-", df2$unifecha)
df2$unifecha <- gsub("-34-","34-", df2$unifecha)
df2$unifecha <- gsub("-5-","5-", df2$unifecha)
df2$unifecha <- gsub("-7-","7-", df2$unifecha)
df2$unifecha <- gsub("-14-","14-", df2$unifecha)
df2$unifecha <- gsub("-16-","16-", df2$unifecha)
df2$unifecha <- gsub("-2-","2-", df2$unifecha)
df2$unifecha <- gsub("-206-","206-", df2$unifecha)
df2$unifecha <- gsub("-24-","24-", df2$unifecha)
df2$unifecha <- gsub("-22-","22-", df2$unifecha)
df2$unifecha <- gsub("-21-","21-", df2$unifecha)
df2$unifecha <- gsub("-25-","25-", df2$unifecha)
df2$unifecha <- gsub("-4-","4-", df2$unifecha)
df2$unifecha <- gsub("-6-","6-", df2$unifecha)
df2$unifecha <- gsub("-5-","5-", df2$unifecha)
df2$unifecha <- gsub("-S20-","S20-", df2$unifecha)
df2$unifecha <- gsub("-3-","3-", df2$unifecha)
df2$unifecha <- gsub("-8-","8-", df2$unifecha)
df2$unifecha <- gsub("-319B-","319B-", df2$unifecha)
df2$unifecha <- gsub("-319B-","319B-", df2$unifecha)
df2$unifecha <- gsub("-101-","101-", df2$unifecha)
df2$unifecha <- gsub("-102-","102-", df2$unifecha)
df2$unifecha <- gsub("-103-","103-", df2$unifecha)
df2$unifecha <- gsub("-104-","104-", df2$unifecha)
df2$unifecha <- gsub("-106-","106-", df2$unifecha)
df2$unifecha <- gsub("-201-","201-", df2$unifecha)
df2$unifecha <- gsub("-203-","203-", df2$unifecha)
df2$unifecha <- gsub("-208-","208-", df2$unifecha)
df2$unifecha <- gsub("-400-","400-", df2$unifecha)
df2$unifecha <- gsub("-402-","402-", df2$unifecha)
df2$unifecha <- gsub("-30-","30-", df2$unifecha)
df2$unifecha <- gsub("-19-","19-", df2$unifecha)
df2$unifecha <- gsub("-9-","9-", df2$unifecha)
df2<- df2%>%select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen,num_camas,count)
df2<-tidyr::separate(df2,col="unifecha",into=c("UNICODE","FECHA"),sep="-")
df2<-df2 %>% mutate(FECHA = as.Date(as.character(FECHA),format = "%d/%m/%Y"))
df2$FECHA<- gsub("-","/", df2$FECHA)
df2= mutate ( df2,unifecha=paste(UNICODE,FECHA,sep ="-" ))
df2<-df2 %>% rename_all(tolower)
df2 <- mutate_if(df2, is.character, toupper)
df2<- df2%>%
select(codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen,num_camas,count,unifecha)
df2<-aggregate(count~unifecha+mascotas_cuarto,data = df2,FUN = sum)
View(df2)
df_mascotas<-dcast(df2,unifecha~mascotas_cuarto )
setnames(df_mascotas,"GATO","HAB_GATO")
setnames(df_mascotas,"GATO/ POLLO","HAB_GATO_POLLO")
setnames(df_mascotas,"PERRO","HAB_PERRO")
aux<- merge(df_total, df_mascotas,by="unifecha",all.x = TRUE)
a1<-anti_join(df_total,df_mascotas)
b1<-semi_join(df_total,df_mascotas)
View(a1)
df_total_masc<- merge(df_total, df_mascotas,by="unifecha",all.x = TRUE)
View(df_total_masc)
df2<-fread("~/cimex_aqp/match/CHINCHES CSV/resultado/archivos_resultado_2020/result_match_cuarto_final.csv")
df2$count<-unlist(1)
#
df2$unifecha <- gsub("-1-","1-", df2$unifecha)
df2$unifecha <- gsub("-10-","10-", df2$unifecha)
df2$unifecha <- gsub("-12-","12-", df2$unifecha)
df2$unifecha <- gsub("-13-","13-", df2$unifecha)
df2$unifecha <- gsub("-32-","32-", df2$unifecha)
df2$unifecha <- gsub("-34-","34-", df2$unifecha)
df2$unifecha <- gsub("-5-","5-", df2$unifecha)
df2$unifecha <- gsub("-7-","7-", df2$unifecha)
df2$unifecha <- gsub("-14-","14-", df2$unifecha)
df2$unifecha <- gsub("-16-","16-", df2$unifecha)
df2$unifecha <- gsub("-2-","2-", df2$unifecha)
df2$unifecha <- gsub("-206-","206-", df2$unifecha)
df2$unifecha <- gsub("-24-","24-", df2$unifecha)
df2$unifecha <- gsub("-22-","22-", df2$unifecha)
df2$unifecha <- gsub("-21-","21-", df2$unifecha)
df2$unifecha <- gsub("-25-","25-", df2$unifecha)
df2$unifecha <- gsub("-4-","4-", df2$unifecha)
df2$unifecha <- gsub("-6-","6-", df2$unifecha)
df2$unifecha <- gsub("-5-","5-", df2$unifecha)
df2$unifecha <- gsub("-S20-","S20-", df2$unifecha)
df2$unifecha <- gsub("-3-","3-", df2$unifecha)
df2$unifecha <- gsub("-8-","8-", df2$unifecha)
df2$unifecha <- gsub("-319B-","319B-", df2$unifecha)
df2$unifecha <- gsub("-319B-","319B-", df2$unifecha)
df2$unifecha <- gsub("-101-","101-", df2$unifecha)
df2$unifecha <- gsub("-102-","102-", df2$unifecha)
df2$unifecha <- gsub("-103-","103-", df2$unifecha)
df2$unifecha <- gsub("-104-","104-", df2$unifecha)
df2$unifecha <- gsub("-106-","106-", df2$unifecha)
df2$unifecha <- gsub("-201-","201-", df2$unifecha)
df2$unifecha <- gsub("-203-","203-", df2$unifecha)
df2$unifecha <- gsub("-208-","208-", df2$unifecha)
df2$unifecha <- gsub("-400-","400-", df2$unifecha)
df2$unifecha <- gsub("-402-","402-", df2$unifecha)
df2$unifecha <- gsub("-30-","30-", df2$unifecha)
df2$unifecha <- gsub("-19-","19-", df2$unifecha)
df2$unifecha <- gsub("-9-","9-", df2$unifecha)
df2<- df2%>%select(unifecha,codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen,num_camas,count)
df2<-tidyr::separate(df2,col="unifecha",into=c("UNICODE","FECHA"),sep="-")
df2<-df2 %>% mutate(FECHA = as.Date(as.character(FECHA),format = "%d/%m/%Y"))
df2$FECHA<- gsub("-","/", df2$FECHA)
df2= mutate ( df2,unifecha=paste(UNICODE,FECHA,sep ="-" ))
df2<-df2 %>% rename_all(tolower)
df2 <- mutate_if(df2, is.character, toupper)
df2<- df2%>%
select(codigo_cuarto,tipo_ambiente,nivel_desorden,mascotas_cuarto,duermen,num_camas,count,unifecha)
df2<-aggregate(count~unifecha+mascotas_cuarto,data = df2,FUN = sum)
df_mascotas<-dcast(df2,unifecha~mascotas_cuarto )
df_mascotas$unifecha <- gsub("1.10.2.1009-2017/09/15","1.10.2.1009-2017/10/18", df_mascotas$unifecha)
setnames(df_mascotas,"GATO","HAB_GATO")
setnames(df_mascotas,"GATO/ POLLO","HAB_GATO_POLLO")
setnames(df_mascotas,"PERRO","HAB_PERRO")
df_mascotas<- df_mascotas%>%
select(unifecha,HAB_GATO,HAB_GATO_POLLO,NINGUNA,HAB_PERRO)
df_total_masc<- merge(df_total, df_mascotas,by="unifecha",all.x = TRUE)
a1<-anti_join(df_total,df_mascotas)
b1<-semi_join(df_total,df_mascotas)
View(a1)
View(df_total_masc)
df3<- fread("~/cimex_aqp/match/CHINCHES CSV/resultado/archivos_resultado_2020/result_match_mueble_final.csv")
df3$count<-unlist(1)
df3<- fread("~/cimex_aqp/match/CHINCHES CSV/resultado/archivos_resultado_2020/result_match_mueble_final.csv")
df3$count<-unlist(1)
df3<- fread("~/cimex_aqp/match/CHINCHES CSV/resultado/archivos_resultado_2020/result_match_mueble_final.csv")
df3$count<-unlist(1)
df3$unifecha <- gsub("-1-","1-", df3$unifecha)
df3$unifecha <- gsub("-10-","10-", df3$unifecha)
df3$unifecha <- gsub("-12-","12-", df3$unifecha)
df3$unifecha <- gsub("-13-","13-", df3$unifecha)
df3$unifecha <- gsub("-32-","32-", df3$unifecha)
df3$unifecha <- gsub("-34-","34-", df3$unifecha)
df3$unifecha <- gsub("-5-","5-", df3$unifecha)
df3$unifecha <- gsub("-7-","7-", df3$unifecha)
df3$unifecha <- gsub("-14-","14-", df3$unifecha)
df3$unifecha <- gsub("-16-","16-", df3$unifecha)
df3$unifecha <- gsub("-2-","2-", df3$unifecha)
df3$unifecha <- gsub("-206-","206-", df3$unifecha)
df3$unifecha <- gsub("-24-","24-", df3$unifecha)
df3$unifecha <- gsub("-22-","22-", df3$unifecha)
df3$unifecha <- gsub("-21-","21-", df3$unifecha)
df3$unifecha <- gsub("-25-","25-", df3$unifecha)
df3$unifecha <- gsub("-4-","4-", df3$unifecha)
df3$unifecha <- gsub("-6-","6-", df3$unifecha)
df3$unifecha <- gsub("-5-","5-", df3$unifecha)
df3$unifecha <- gsub("-S20-","S20-", df3$unifecha)
df3$unifecha <- gsub("-3-","3-", df3$unifecha)
df3$unifecha <- gsub("-8-","8-", df3$unifecha)
df3$unifecha <- gsub("-319B-","319B-", df3$unifecha)
df3$unifecha <- gsub("-319B-","319B-", df3$unifecha)
df3$unifecha <- gsub("-101-","101-", df3$unifecha)
df3$unifecha <- gsub("-102-","102-", df3$unifecha)
df3$unifecha <- gsub("-103-","103-", df3$unifecha)
df3$unifecha <- gsub("-104-","104-", df3$unifecha)
df3$unifecha <- gsub("-106-","106-", df3$unifecha)
df3$unifecha <- gsub("-201-","201-", df3$unifecha)
df3$unifecha <- gsub("-203-","203-", df3$unifecha)
df3$unifecha <- gsub("-208-","208-", df3$unifecha)
df3$unifecha <- gsub("-400-","400-", df3$unifecha)
df3$unifecha <- gsub("-402-","402-", df3$unifecha)
df3$unifecha <- gsub("-30-","30-", df3$unifecha)
df3$unifecha <- gsub("-19-","19-", df3$unifecha)
df3$unifecha <- gsub("-9-","9-", df3$unifecha)
df3<-tidyr::separate(df3,col="unifecha",into=c("UNICODE","FECHA"),sep="-")
df3<-df3 %>%
mutate(FECHA = as.Date(as.character(FECHA), format = "%d/%m/%Y"))
View(df3)
df3$FECHA<- gsub("-","/", df3$FECHA)
View(df3)
df3$UNICODE <- gsub("-","", df3$UNICODE)
df3= mutate ( df3,unifecha=paste(UNICODE,FECHA,sep = "-" ))
df3<- df3%>%
select(unifecha,cod_cuarto,cod_mueble,tipo_mueble,madera_pte,madera_chinche,metal_pte,metal_chinche,tela_pte,tela_chinche,plastico_pte,plastico_chinche,mapresa_pte,mapresa_chinche,melamina_pte,melamina_chinche)
df3<-df3 %>% rename_all(tolower)
View(df3)
View(df3)
View(df_total_masc)
df3$count<- unlist(1)
df3_mat_mueble_chin<-aggregate(count ~ unifecha+madera_chinche+metal_chinche+tela_chinche+plastico_chinche+mapresa_chinche+melamina_chinche, data=df3, FUN=sum)
View(df3_mat_mueble_chin)
df3[duplicated(df3$unifecha), ]
df3_mat_mueble_chin[!duplicated(df3_mat_mueble_chin), ]
df3_mat_mueble_chin<-aggregate(count ~ unifecha+madera_chinche+metal_chinche+tela_chinche+plastico_chinche+mapresa_chinche+melamina_chinche, data=df3, FUN=sum)
df3_mat_mueble_chin<-df3_mat_mueble_chin[!duplicated(df3_mat_mueble_chin$unifecha), ]
View(df3_mat_mueble_chin)
View(df3_mat_mueble_chin)
View(df3)
df3_mueble<-aggregate(count~unifecha+tipo_mueble,data = df3,FUN = sum)
View(df3_mueble)
View(df3_mueble)
df3_mueble<-dcast(df3_mueble,unifecha~tipo_mueble )
View(df3_mueble)
View(df3_mueble)
df3_mat_mueble_chin<-aggregate(count ~ unifecha+madera_chinche+metal_chinche+tela_chinche+plastico_chinche+mapresa_chinche+melamina_chinche, data=df3, FUN=sum)
View(df3_mat_mueble_chin)
View(df3_mat_mueble_chin)
View(df3_mat_mueble_chin)
View(df3_mat_mueble_chin)
View(df3_mat_mueble_chin)
View(df3_mat_mueble_chin)
df3_mat_mueble_chin<-df3_mat_mueble_chin%>%filter(madera_chinche==1|metal_chinche==1|tela_chinche==1,plastico_chinche==1,mapresa_chinche=1,melamina_chinche=1)
df3_mat_mueble_chin<-df3_mat_mueble_chin%>%filter(madera_chinche==1|metal_chinche==1|tela_chinche==1,plastico_chinche==1,mapresa_chinche==1,melamina_chinche==1)
df3_mat_mueble_chin<-aggregate(count ~ unifecha+madera_chinche+metal_chinche+tela_chinche+plastico_chinche+mapresa_chinche+melamina_chinche, data=df3, FUN=sum)
df3_mat_mueble_chin<-df3_mat_mueble_chin%>%filter(madera_chinche==1|metal_chinche==1|tela_chinche==1|plastico_chinche==1|mapresa_chinche==1|melamina_chinche==1)
View(df3_mat_mueble_chin)
df_total_masc_mueb<-merge(df_total_masc,df3_mat_mueble_chin,by="unifecha",all.x = TRUE)
View(df_total_masc_mueb)
a2<-anti_join(df_total_masc,df3_mat_mueble_chin)
b2<-semi_join(df_total_masc,df3_mat_mueble_chin)
View(a2)
View(b2)
View(df_total_masc_mueb)
df3<- fread("~/cimex_aqp/match/CHINCHES CSV/resultado/archivos_resultado_2020/result_match_mueble_final.csv")
df3$count<-unlist(1)
df3$unifecha <- gsub("-1-","1-", df3$unifecha)
df3$unifecha <- gsub("-10-","10-", df3$unifecha)
df3$unifecha <- gsub("-12-","12-", df3$unifecha)
df3$unifecha <- gsub("-13-","13-", df3$unifecha)
df3$unifecha <- gsub("-32-","32-", df3$unifecha)
df3$unifecha <- gsub("-34-","34-", df3$unifecha)
df3$unifecha <- gsub("-5-","5-", df3$unifecha)
df3$unifecha <- gsub("-7-","7-", df3$unifecha)
df3$unifecha <- gsub("-14-","14-", df3$unifecha)
df3$unifecha <- gsub("-16-","16-", df3$unifecha)
df3$unifecha <- gsub("-2-","2-", df3$unifecha)
df3$unifecha <- gsub("-206-","206-", df3$unifecha)
df3$unifecha <- gsub("-24-","24-", df3$unifecha)
df3$unifecha <- gsub("-22-","22-", df3$unifecha)
df3$unifecha <- gsub("-21-","21-", df3$unifecha)
df3$unifecha <- gsub("-25-","25-", df3$unifecha)
df3$unifecha <- gsub("-4-","4-", df3$unifecha)
df3$unifecha <- gsub("-6-","6-", df3$unifecha)
df3$unifecha <- gsub("-5-","5-", df3$unifecha)
df3$unifecha <- gsub("-S20-","S20-", df3$unifecha)
df3$unifecha <- gsub("-3-","3-", df3$unifecha)
df3$unifecha <- gsub("-8-","8-", df3$unifecha)
df3$unifecha <- gsub("-319B-","319B-", df3$unifecha)
df3$unifecha <- gsub("-319B-","319B-", df3$unifecha)
df3$unifecha <- gsub("-101-","101-", df3$unifecha)
df3$unifecha <- gsub("-102-","102-", df3$unifecha)
df3$unifecha <- gsub("-103-","103-", df3$unifecha)
df3$unifecha <- gsub("-104-","104-", df3$unifecha)
df3$unifecha <- gsub("-106-","106-", df3$unifecha)
df3$unifecha <- gsub("-201-","201-", df3$unifecha)
df3$unifecha <- gsub("-203-","203-", df3$unifecha)
df3$unifecha <- gsub("-208-","208-", df3$unifecha)
df3$unifecha <- gsub("-400-","400-", df3$unifecha)
df3$unifecha <- gsub("-402-","402-", df3$unifecha)
df3$unifecha <- gsub("-30-","30-", df3$unifecha)
df3$unifecha <- gsub("-19-","19-", df3$unifecha)
df3$unifecha <- gsub("-9-","9-", df3$unifecha)
df3<-tidyr::separate(df3,col="unifecha",into=c("UNICODE","FECHA"),sep="-")
View(df3)
df3<-df3 %>%
mutate(FECHA = as.Date(as.character(FECHA), format = "%d/%m/%Y"))
df3$FECHA<- gsub("-","/", df3$FECHA)
df3$UNICODE <- gsub("-","", df3$UNICODE)
df3= mutate ( df3,unifecha=paste(UNICODE,FECHA,sep = "-" ))
df3<- df3%>%
select(unifecha,cod_cuarto,cod_mueble,tipo_mueble,madera_pte,madera_chinche,metal_pte,metal_chinche,tela_pte,tela_chinche,plastico_pte,plastico_chinche,mapresa_pte,mapresa_chinche,melamina_pte,melamina_chinche)
df3<-df3 %>% rename_all(tolower)
# df3$cod_mueble <- gsub("-","", df3$cod_mueble)
# df3$cod_mueble <- gsub("_","", df3$cod_mueble)
df3$count<- unlist(1)
df3_mat_mueble_chin<-aggregate(count ~ unifecha+madera_chinche+metal_chinche+tela_chinche+plastico_chinche+mapresa_chinche+melamina_chinche, data=df3, FUN=sum)
df3_mat_mueble_chin<-df3_mat_mueble_chin%>%filter(madera_chinche==1|metal_chinche==1|tela_chinche==1|plastico_chinche==1|mapresa_chinche==1|melamina_chinche==1)
View(df3_mat_mueble_chin)
df_total_masc_mueb<-merge(df_total_masc,df3_mat_mueble_chin,by="unifecha",all.x = TRUE)
a2<-anti_join(df_total_masc,df3_mat_mueble_chin)
b2<-semi_join(df_total_masc,df3_mat_mueble_chin)
View(df_total_masc_mueb)
df_total_masc_mueb<-df_total_masc_mueb[!duplicated(df_total_masc_mueb$unifecha), ]
View(df_total_masc_mueb)
df4<- fread("~/cimex_aqp/match/CHINCHES CSV/resultado/archivos_resultado_2020/result_match_pared_final.csv")
df4<- fread("~/cimex_aqp/match/CHINCHES CSV/resultado/archivos_resultado_2020/result_match_pared_final.csv")
df4$unifecha <- gsub("-1-","1-", df4$unifecha)
df4$unifecha <- gsub("-10-","10-", df4$unifecha)
df4$unifecha <- gsub("-12-","12-", df4$unifecha)
df4$unifecha <- gsub("-13-","13-", df4$unifecha)
df4$unifecha <- gsub("-32-","32-", df4$unifecha)
df4$unifecha <- gsub("-34-","34-", df4$unifecha)
df4$unifecha <- gsub("-5-","5-", df4$unifecha)
df4$unifecha <- gsub("-7-","7-", df4$unifecha)
df4$unifecha <- gsub("-14-","14-", df4$unifecha)
df4$unifecha <- gsub("-16-","16-", df4$unifecha)
df4$unifecha <- gsub("-2-","2-", df4$unifecha)
df4$unifecha <- gsub("-206-","206-", df4$unifecha)
df4$unifecha <- gsub("-24-","24-", df4$unifecha)
df4$unifecha <- gsub("-22-","22-", df4$unifecha)
df4$unifecha <- gsub("-21-","21-", df4$unifecha)
df4$unifecha <- gsub("-25-","25-", df4$unifecha)
df4$unifecha <- gsub("-4-","4-", df4$unifecha)
df4$unifecha <- gsub("-6-","6-", df4$unifecha)
df4$unifecha <- gsub("-5-","5-", df4$unifecha)
df4$unifecha <- gsub("-S20-","S20-", df4$unifecha)
df4$unifecha <- gsub("-3-","3-", df4$unifecha)
df4$unifecha <- gsub("-8-","8-", df4$unifecha)
df4$unifecha <- gsub("-319B-","319B-", df4$unifecha)
df4$unifecha <- gsub("-319B-","319B-", df4$unifecha)
df4$unifecha <- gsub("-101-","101-", df4$unifecha)
df4$unifecha <- gsub("-102-","102-", df4$unifecha)
df4$unifecha <- gsub("-103-","103-", df4$unifecha)
df4$unifecha <- gsub("-104-","104-", df4$unifecha)
df4$unifecha <- gsub("-106-","106-", df4$unifecha)
df4$unifecha <- gsub("-201-","201-", df4$unifecha)
df4$unifecha <- gsub("-203-","203-", df4$unifecha)
df4$unifecha <- gsub("-208-","208-", df4$unifecha)
df4$unifecha <- gsub("-400-","400-", df4$unifecha)
df4$unifecha <- gsub("-402-","402-", df4$unifecha)
df4$unifecha <- gsub("-30-","30-", df4$unifecha)
df4$unifecha <- gsub("-19-","19-", df4$unifecha)
df4$unifecha <- gsub("-9-","9-", df4$unifecha)
df4<-tidyr::separate(df4,col="unifecha",into=c("UNICODE","FECHA"),sep="-")
View(df4)
df4<-df4 %>%
mutate(FECHA = as.Date(as.character(FECHA), format = "%d/%m/%Y"))
df4$FECHA<- gsub("-","/", df4$FECHA)
df4$UNICODE <- gsub("-","", df4$UNICODE)
df4= mutate ( df4,unifecha=paste(UNICODE,FECHA,sep = "-" ))
View(df4)
View(df4)
df4<- df4%>%
df4<- df4%>%
select(unifecha,cod_cuarto,lugar,lad_chinche,sillar_chinche,madera_chinche,piedra_chinche,noble_chinche,adobe_chinche,calamina_chinche,drywall_chinche,carrizo_chinche,quincha_chinche,bloqueta_chinche,plastico_chinche,grietas)
df4<-df4%>%
select(unifecha,cod_cuarto,lugar,lad_chinche,sillar_chinche,madera_chinche,piedra_chinche,noble_chinche,adobe_chinche,calamina_chinche,drywall_chinche,carrizo_chinche,quincha_chinche,bloqueta_chinche,plastico_chinche,grietas)
df4$count<-unlist(1)
View(df4)
df_grietas<-dcast(df4,unifecha~grietas+sillar_chinche)
df_grietas<-dcast(df4,unifecha~grietas)
View(df_grietas)
df4<-df4%>%
select(unifecha,cod_cuarto,lugar,lad_chinche,sillar_chinche,madera_chinche,piedra_chinche,noble_chinche,adobe_chinche,calamina_chinche,drywall_chinche,carrizo_chinche,quincha_chinche,bloqueta_chinche,plastico_chinche,grietas)
View(df4)
View(df4)
df4$count<-unlist(1)
df4_grietas<-aggregate(count ~ unifecha+grietas,data=df4, FUN=sum)
View(df4_grietas)
df4_grietas<-dcast(df4_grietas,unifecha~grietas)
View(df4_grietas)
df4_grietas <- df4_grietas %>% rename("h_grietas" = "1")
setnames(df4_grietas,old ="1",new ="h_grietas" )
df4_grietas<- df4_grietas%>%
select(unifecha,h_grietas)
View(df4_grietas)
df4_material_pared<-aggregate(count ~ unifecha+lad_chinche+sillar_chinche+madera_chinche+piedra_chinche+noble_chinche+adobe_chinche+calamina_chinche+drywall_chinche+carrizo_chinche+quincha_chinche+bloqueta_chinche+plastico_chinche,data=df4, FUN=sum)
View(df4_material_pared)
df4_grietas<-aggregate(count ~ unifecha+grietas,data=df4, FUN=sum)
View(df4_grietas)
df4_grietas<-aggregate(count ~ unifecha+grietas,data=df4, FUN=sum)
df4_grietas<-dcast(df4_grietas,unifecha~grietas)
setnames(df4_grietas,old ="1",new ="h_grietas" )
df4_grietas<- df4_grietas%>%
select(unifecha,h_grietas)
df4_material_pared<-aggregate(count ~ unifecha+lad_chinche+sillar_chinche+madera_chinche+piedra_chinche+noble_chinche+adobe_chinche+calamina_chinche+drywall_chinche+carrizo_chinche+quincha_chinche+bloqueta_chinche+plastico_chinche,data=df4, FUN=sum)
View(df4_material_pared)
df4_ag<-aggregate(count ~ unifecha+lad_chinche+sillar_chinche+madera_chinche+piedra_chinche+noble_chinche+adobe_chinche+calamina_chinche+drywall_chinche+carrizo_chinche+quincha_chinche+bloqueta_chinche+plastico_chinche,data=df4, FUN=sum)
df_lad<-dcast(df4_ag,unifecha~lad_pte)
df4_ag<-aggregate(count ~ unifecha+lad_chinche+sillar_chinche+madera_chinche+piedra_chinche+noble_chinche+adobe_chinche+calamina_chinche+drywall_chinche+carrizo_chinche+quincha_chinche+bloqueta_chinche+plastico_chinche,data=df4, FUN=sum)
View(df4_ag)
df_lad<-dcast(df4_ag,unifecha~lad_pte)
df_lad<-dcast(df4_ag,unifecha~lad_chinche)
View(df_lad)
df_lad <- df_lad %>% rename("h_lad" = "1")
setnames(df_lad,old ="1",new ="h_lad" )
View(df_lad)
df_lad<- df_lad%>%
select(unifecha,h_lad)
View(df_lad)
df_sillar<-dcast(df4_ag,unifecha~sillar_chinche)
setnames(df_sillar,old ="1",new ="h_sill" )
df_sillar<- df_sillar%>%
select(unifecha,h_sill)
df_madera<-dcast(df4_ag,unifecha~madera_chinche)
setnames(df_madera,old ="1",new ="h_madera" )
df_madera<- df_madera%>%
select(unifecha,h_madera)
View(df_madera)
df_piedra<-dcast(df4_ag,unifecha~piedra_chinche)
setnames(df_piedra,old ="1",new ="h_piedra" )
df_piedra<-dcast(df4_ag,unifecha~piedra_chinche)
View(df_piedra)
df_noble<-dcast(df4_ag,unifecha~noble_chinche)
setnames(df_noble,old ="1",new ="h_nob" )
df_noble<- df_noble%>%
select(unifecha,h_nob)
View(df_noble)
df_noble<-dcast(df4_ag,unifecha~noble_chinche)
View(df_noble)
setnames(df_noble,old ="1",new ="h_nob" )
df_noble<- df_noble%>%
select(unifecha,h_nob)
df_adobe<-dcast(df4_ag,unifecha~adobe_chinche)
setnames(df_adobe,old ="1",new ="h_adobe" )
View(df_adobe)
df_calamina<-dcast(df4_ag,unifecha~calamina_chinche)
View(df_calamina)
df_drywall<-dcast(df4_ag,unifecha~drywall_chinche)
View(df_drywall)
setnames(df_drywall,old ="1",new ="h_dry" )
df_drywall<- df_drywall%>%
select(unifecha,h_dry)
df_carrizo<-dcast(df4_ag,unifecha~carrizo_chinche)
View(df_carrizo)
df_quincha<-dcast(df4_ag,unifecha~quincha_chinche)
View(df_quincha)
df_bloqueta<-dcast(df4_ag,unifecha~bloqueta_chinche)
View(df_bloqueta)
setnames(df_bloqueta,old ="1",new ="h_bloq" )
df_bloqueta<- df_bloqueta%>%
select(unifecha,h_bloq)
df_plastico<-dcast(df4_ag,unifecha~plastico_chinche)
View(df_plastico)
setnames(df_plastico,old ="1",new ="h_plastico" )
df_plastico<- df_plastico%>%
select(unifecha,h_plastico)
# df_material<-merge(df_grietas,df_lad, by="unifecha",all = TRUE)
df_material<-merge(df_grietas,df_lad, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_sillar, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_madera, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_plastico, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_bloqueta, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_drywall, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_noble, by="unifecha",all = TRUE)
View(df_material)
View(df_grietas)
df4_grietas<-aggregate(count ~ unifecha+grietas,data=df4, FUN=sum)
df4_grietas<-dcast(df4_grietas,unifecha~grietas)
View(df4_grietas)
setnames(df4_grietas,old ="1",new ="h_grietas" )
View(df4_grietas)
df4_grietas<- df4_grietas%>%
select(unifecha,h_grietas)
df_material<-merge(df4_grietas,df_lad, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_sillar, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_madera, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_plastico, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_bloqueta, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_drywall, by="unifecha",all = TRUE)
df_material<-merge(df_material,df_noble, by="unifecha",all = TRUE)
View(df_material)
View(df_material)
df_final<-merge(df_total_masc_mueb,df_material,by = "unifecha",all.x = TRUE)
View(df_final)
a3<-anti_join(df_total_masc_mueb,df_material)
b3<-semi_join(df_total_masc_mueb,df_material)
View(a3)
View(b3)
View(a3)
View(acumulado1)
write.csv(df_final, "~/cimex_aqp/Cimex_Archivos/data_drive/phd_tesis_claudia/base_cimex_202000417.csv",row.names = FALSE)
>>>>>>> db75ca8d8dfbe58c8e98f3054c428773cc066653
