##### fecha to as.date format ####
covid_ind<-covid_ind %>%
mutate(FECHA = as.Date(as.character(FECHA), format = "%d/%m/%y"))
### ordenar base ###
names(covid_ind)
covid_ind <- covid_ind[,c(1, 2, 21:23, 3:20)]
# ID del caso
str(covid_ind$CASO_ID) # int
unique(covid_ind$CASO_ID)
## Fecha
str(covid_ind$FECHA) # date
unique(covid_ind$FECHA)
# Cambiar nombre de variable en googlesheet
unique(covid_ind$REGION)
# Cambiar Huanuco
levels(covid_ind$REGION) <- c(levels(covid_ind$REGION),
c("APURIMAC", "HUANUCO",
"JUNIN", "SAN MARTIN"))
## Region
str(covid_ind$REGION) # character
covid_ind$REGION[covid_ind$REGION == "HUÃ¡NUCO"] <- "HUANUCO"
covid_ind$REGION[covid_ind$REGION == ""] <- NA
unique(covid_ind$REGION) # ok
## Provincia
str(covid_ind$PROVINCIA) # chr
unique(covid_ind$PROVINCIA)
levels(covid_ind$PROVINCIA) <- c(levels(covid_ind$PROVINCIA),
c("APURIMAC", "HUANUCO",
"JUNIN", "SAN MARTIN", "FERRENAFE"))
covid_ind$PROVINCIA[covid_ind$PROVINCIA == "FERREÃ±AFE"] <- "FERRENAFE"
covid_ind$PROVINCIA[covid_ind$PROVINCIA == ""] <- NA
unique(covid_ind$PROVINCIA)
## Distrito
str(covid_ind$DISTRITO) # chr
unique(covid_ind$DISTRITO)
# [55] "ZARUMILLA"                     "MOYOBAMBA"
# [57] "NUEVA CAJAMARCA"               "RUPA RUPA"
# [59] "VICTOR LARCO"                  "FERREÃ±AFE"
# [61] "REQUE"                         "LAMBAYEQUE"
# [63] "CIUDAD ETEN"                   "TACNA"
# [65] "INDEPENDENCIA"                 "POMACOCHA"
# [67] "RAZURI"                        "MONSEFU"
# [69] "SECHURA"                       "TUMBES"
# [71] "ZORRITOS"
# Hay  ""
covid_ind$DISTRITO[covid_ind$DISTRITO == "FERREÃ±AFE"] <- "FERRENAFE"
covid_ind$DISTRITO[covid_ind$DISTRITO == ""] <- NA
unique(covid_ind$DISTRITO)
## Direccion
str(covid_ind$DIRECCION) # logi
unique(covid_ind$DIRECCION) # NA
## Call data
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200326_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200327_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200331_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200401_MD.csv")
# covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200402_MD.csv")
covid_ind <- fread("~/covid19/data/crudas/covidPE_IND_20200403_MD.csv")
str(covid_ind) # 1412 obs. of  20 variables
names(covid_ind)
# [1] "CASO_ID"              "FECHA"                "REGION"
# [4] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [7] "EDAD_A"               "SEXOM1H0"             "HOSPITALIZADOS1N0"
# [10] "AISLADODOMICILS1N0"   "CONTACTO"             "IMPORTADO"
# [13] "ORIGEN_INTERNACIONAL" "CASO_CONTACTO"        "RELACION_CONTACTO"
# [16] "ORIGEN_NACIONAL"      "ENLACES1"             "ENLACES2"
# [19] "ENLACES3"             "OBSERVACIONES"
# Mas adelante  Sacar los "S1N0 del nombre de la variable
head(covid_ind)
# Transformar todo texto a mayusculas
# Transform to character
covid_ind <- mutate_if(covid_ind, is.character, toupper)
sapply(covid_ind, class)
# CASO_ID                FECHA               REGION            PROVINCIA
# "integer"          "character"          "character"          "character"
# DISTRITO            DIRECCION               EDAD_A             SEXOM1H0
# "character"            "logical"          "character"            "integer"
# HOSPITALIZADOS1N0   AISLADODOMICILS1N0             CONTACTO            IMPORTADO
# "integer"            "integer"          "character"            "integer"
# ORIGEN_INTERNACIONAL        CASO_CONTACTO    RELACION_CONTACTO      ORIGEN_NACIONAL
# "character"            "integer"          "character"          "character"
# ENLACES1             ENLACES2             ENLACES3        OBSERVACIONES
# "character"          "character"          "character"          "character"
### variableby variable
### Caso_ID ###
table(covid_ind$CASO_ID)
# 1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18  19  20  21  22
# 1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
# 23  24  25  26  27  28  44  69  71  73 106 145
# 1   1   1   1   1   1   1   1   1   1   1   1
### Fecha ####
table(covid_ind$FECHA)
# 01/04/2020 02/04/2020 06/03/2020 07/03/2020 09/03/2020 10/03/2020 11/03/2020 12/03/2020
# 258         91          1          5          3          2          6          5
# 13/03/2020 14/03/2020 15/03/2020 16/03/2020 17/03/2020 18/03/2020 19/03/2020 20/03/2020
# 16          5         28         15         31         29         89         29
# 21/03/2020 22/03/2020 23/03/2020 24/03/2020 25/03/2020 26/03/2020 27/03/2020 28/03/2020
# 55         43         32         21         64         99         55         36
# 29/03/2020 30/03/2020 31/03/2020
# 176        103        115
#### separando caracteres en varias columnas ######
covid_ind$FECHA2 <- covid_ind$FECHA
covid_ind <- separate(covid_ind,
col = "FECHA2",
into = c("DIA", "MES","ANO"),
sep = "/")
##### fecha to as.date format ####
covid_ind<-covid_ind %>%
mutate(FECHA = as.Date(as.character(FECHA), format = "%d/%m/%y"))
### ordenar base ###
names(covid_ind)
# [1] "CASO_ID"              "FECHA"                "REGION"
# [4] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [7] "EDAD_A"               "SEXOM1H0"             "HOSPITALIZADOS1N0"
# [10] "AISLADODOMICILS1N0"   "CONTACTO"             "IMPORTADO"
# [13] "ORIGEN_INTERNACIONAL" "CASO_CONTACTO"        "RELACION_CONTACTO"
# [16] "ORIGEN_NACIONAL"      "ENLACES1"             "ENLACES2"
# [19] "ENLACES3"             "OBSERVACIONES"        "DIA"
# [22] "MES"                  "ANO"
covid_ind <- covid_ind[,c(1, 2, 21:23, 3:20)]
### Check NAs and inconsistencies ###
# ID del caso
str(covid_ind$CASO_ID) # int
unique(covid_ind$CASO_ID)
### Para manejo nuestro, completar n[umero de casos en google spreadsheet.
## Fecha
str(covid_ind$FECHA) # date
unique(covid_ind$FECHA)
# ok
## Region
str(covid_ind$REGION) # character
# Cambiar nombre de variable en googlesheet
unique(covid_ind$REGION)
# [1] "LIMA"          "AREQUIPA"      "HUÃ¡NUCO"      "ICA"           "CUSCO"
# [6] "ANCASH"        "CALLAO"        "LA LIBERTAD"   "LAMBAYEQUE"    "PIURA"
# [11] "LORETO"        "MADRE DE DIOS" "SAN MARTIN"    "JUNIN"         "TUMBES"
# [16] "CAJAMARCA"     "HUANUCO"       "PASCO"         "AYACUCHO"      "TACNA"
# [21] "HUANCAVELICA"  ""
# "HuÃ¡nuco" con tilde
# Cambiar Huanuco
levels(covid_ind$REGION) <- c(levels(covid_ind$REGION),
c("APURIMAC", "HUANUCO",
"JUNIN", "SAN MARTIN"))
covid_ind$REGION[covid_ind$REGION == "HUÃ¡NUCO"] <- "HUANUCO"
covid_ind$REGION[covid_ind$REGION == ""] <- NA
unique(covid_ind$REGION) # ok
## Provincia
str(covid_ind$PROVINCIA) # chr
unique(covid_ind$PROVINCIA)
levels(covid_ind$PROVINCIA) <- c(levels(covid_ind$PROVINCIA),
c("APURIMAC", "HUANUCO",
"JUNIN", "SAN MARTIN", "FERRENAFE"))
covid_ind$PROVINCIA[covid_ind$PROVINCIA == "FERREÃ±AFE"] <- "FERRENAFE"
covid_ind$PROVINCIA[covid_ind$PROVINCIA == ""] <- NA
unique(covid_ind$PROVINCIA)
## Distrito
str(covid_ind$DISTRITO) # chr
unique(covid_ind$DISTRITO)
# [57] "NUEVA CAJAMARCA"               "RUPA RUPA"
# [59] "VICTOR LARCO"                  "FERREÃ±AFE"
# [61] "REQUE"                         "LAMBAYEQUE"
# [63] "CIUDAD ETEN"                   "TACNA"
# [65] "INDEPENDENCIA"                 "POMACOCHA"
# [67] "RAZURI"                        "MONSEFU"
# [69] "SECHURA"                       "TUMBES"
# [71] "ZORRITOS"                      "NAUTA"
# [73] "CORRALES"
# Hay  ""
covid_ind$DISTRITO[covid_ind$DISTRITO == "FERREÃ±AFE"] <- "FERRENAFE"
covid_ind$DISTRITO[covid_ind$DISTRITO == ""] <- NA
unique(covid_ind$DISTRITO)
## Direccion
str(covid_ind$DIRECCION) # logi
unique(covid_ind$DIRECCION) # NA
## Edad
str(covid_ind$EDAD_A) # chr
covid_ind$EDAD_A_n <- as.numeric(covid_ind$EDAD_A)
str(covid_ind$EDAD_A_n)# ok
table(covid_ind$EDAD_A_n) # ok, from 2 to 96.
covid_ind$EDAD_A[covid_ind$EDAD_A == ""] <- NA
## Sexo
str(covid_ind$SEXOM1H0) # int
table(covid_ind$SEXOM1H0) # 0 and 1
## Hospitalizado
str(covid_ind$HOSPITALIZADOS1N0) # int
table(covid_ind$HOSPITALIZADOS1N0) # 0 and 1
## AisladoDomicil
str(covid_ind$AISLADODOMICILS1N0) # int
table(covid_ind$AISLADODOMICILS1N0) # 0 and 1
## cONTACTO
str(covid_ind$CONTACTO) # CHR
unique(covid_ind$CONTACTO)
# Dividir en 3 o 4 columnas esta inforamci[on como se indic[o en el googlesheet.
covid_ind$CONTACTO[covid_ind$CONTACTO == ""] <- NA
## IMPORTADO
str(covid_ind$IMPORTADO) # int
unique(covid_ind$IMPORTADO)
# [1] "1"    "0"    NA
covid_ind$IMPORTADO[covid_ind$IMPORTADO == "LINK"] <- NA
covid_ind$IMPORTADO[covid_ind$IMPORTADO == ""] <- NA
## ORIGEN_INTERNACIONAL
str(covid_ind$ORIGEN_INTERNACIONAL) # chr
unique(covid_ind$ORIGEN_INTERNACIONAL)
# [1] "EUROPA"        ""              "UK"            "ESPANA"        "ITALIA"
# [6] "WASHINGTON DC" "EEUU"
# Hay ""
covid_ind$ORIGEN_INTERNACIONAL[covid_ind$ORIGEN_INTERNACIONAL == ""] <- NA
unique(covid_ind$ORIGEN_INTERNACIONAL)
covid_ind$ORIGEN_INTERNACIONAL[covid_ind$ORIGEN_INTERNACIONAL == "LINK 2"] <- NA
## CASO_CONTACTO
str(covid_ind$CASO_CONTACTO) # int
unique(covid_ind$CASO_CONTACTO)
## RELACION_CONTACTO
str(covid_ind$RELACION_CONTACTO) # chr
unique(covid_ind$RELACION_CONTACTO)
# [1] NA     "FAMILIAR"    "AMIGO"       ""    "TURISTA"     "RELACIONADO"
# Hay ""
covid_ind$RELACION_CONTACTO[covid_ind$RELACION_CONTACTO == ""] <- NA
## ORIGEN_NACIONAL
str(covid_ind$ORIGEN_NACIONAL) # chr
unique(covid_ind$ORIGEN_NACIONAL)
# [1] "LIMA"           "AREQUIPA"       "HUANUCO"        "CHINCHA"        ""
# [6] "CUSCO"          "NUEVO CHIMBOTE" "HUANCHACO"      "LA VICTORIA"    "PIURA"
# [11] "CHICLAYO"       "IQUITOS"        "TRUJILLO"
# Hay ""
covid_ind$ORIGEN_NACIONAL[covid_ind$ORIGEN_NACIONAL == ""] <- NA
## Double check "" and count NAs
unique(covid_ind$CASO_ID)
sum(is.na(covid_ind$CASO_ID)) # 1378 NAs
unique(covid_ind$FECHA)
sum(is.na(covid_ind$FECHA)) # 0 NAs
unique(covid_ind$DIA)
sum(is.na(covid_ind$DIA)) # 0 NAs
unique(covid_ind$MES)
sum(is.na(covid_ind$MES)) # 0 NAs
unique(covid_ind$ANO)
sum(is.na(covid_ind$ANO)) # 0 NAs
sum(is.na(covid_ind$REGION)) # 0 NAs
unique(covid_ind$REGION)
unique(covid_ind$PROVINCIA)
sum(is.na(covid_ind$PROVINCIA)) # 650 NAs
unique(covid_ind$DISTRITO)
sum(is.na(covid_ind$DISTRITO)) # 1213 NAs
unique(covid_ind$DIRECCION)
sum(is.na(covid_ind$DIRECCION)) # 1412 NAs
unique(covid_ind$EDAD_A_n)
sum(is.na(covid_ind$EDAD_A_n)) # 1263 NAs
unique(covid_ind$SEXOM1H0)
sum(is.na(covid_ind$SEXOM1H0)) # 718 NAs
sum(is.na(covid_ind$DISTRITO)) # 1205 NAs
unique(covid_ind$DIRECCION)
sum(is.na(covid_ind$DIRECCION)) # 1412 NAs
unique(covid_ind$EDAD_A_n)
sum(is.na(covid_ind$EDAD_A_n)) # 1252 NAs
unique(covid_ind$SEXOM1H0)
sum(is.na(covid_ind$SEXOM1H0)) # 718 NAs
unique(covid_ind$HOSPITALIZADOS1N0)
sum(is.na(covid_ind$HOSPITALIZADOS1N0)) #1227 NAs
unique(covid_ind$AISLADODOMICILS1N0)
sum(is.na(covid_ind$AISLADODOMICILS1N0)) # 1247 NAs
unique(covid_ind$CONTACTO)
sum(is.na(covid_ind$CONTACTO)) # 1278 NAs
unique(covid_ind$IMPORTADO)
sum(is.na(covid_ind$IMPORTADO)) # 1377 NAs
unique(covid_ind$ORIGEN_INTERNACIONAL)
sum(is.na(covid_ind$ORIGEN_INTERNACIONAL)) # 1395 NAs
unique(covid_ind$CASO_CONTACTO)
sum(is.na(covid_ind$CASO_CONTACTO)) # 1394 NAs
unique(covid_ind$RELACION_CONTACTO)
sum(is.na(covid_ind$RELACION_CONTACTO)) # 1394 NAs
unique(covid_ind$ORIGEN_NACIONAL)
sum(is.na(covid_ind$ORIGEN_NACIONAL)) # 1377 NAs
# Save dataset
names(covid_ind)
covid_ind <- covid_ind[,c(1:10,24,11:23)]
names(covid_ind)
# [1] "CASO_ID"              "FECHA"                "DIA"
# [1] "CASO_ID"              "FECHA"                "DIA"
# [4] "MES"                  "ANO"                  "REGION"
# [1] "CASO_ID"              "FECHA"                "DIA"
# [4] "MES"                  "ANO"                  "REGION"
# [7] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [1] "CASO_ID"              "FECHA"                "DIA"
# [4] "MES"                  "ANO"                  "REGION"
# [7] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [10] "EDAD_A"               "EDAD_A_n"             "SEXOM1H0"
# [1] "CASO_ID"              "FECHA"                "DIA"
# [4] "MES"                  "ANO"                  "REGION"
# [7] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [10] "EDAD_A"               "EDAD_A_n"             "SEXOM1H0"
# [13] "HOSPITALIZADOS1N0"    "AISLADODOMICILS1N0"   "CONTACTO"
# [1] "CASO_ID"              "FECHA"                "DIA"
# [4] "MES"                  "ANO"                  "REGION"
# [7] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [10] "EDAD_A"               "EDAD_A_n"             "SEXOM1H0"
# [13] "HOSPITALIZADOS1N0"    "AISLADODOMICILS1N0"   "CONTACTO"
# [16] "IMPORTADO"            "ORIGEN_INTERNACIONAL" "CASO_CONTACTO"
# [1] "CASO_ID"              "FECHA"                "DIA"
# [4] "MES"                  "ANO"                  "REGION"
# [7] "PROVINCIA"            "DISTRITO"             "DIRECCION"
# [10] "EDAD_A"               "EDAD_A_n"             "SEXOM1H0"
# [13] "HOSPITALIZADOS1N0"    "AISLADODOMICILS1N0"   "CONTACTO"
# [16] "IMPORTADO"            "ORIGEN_INTERNACIONAL" "CASO_CONTACTO"
# [19] "RELACION_CONTACTO"    "ORIGEN_NACIONAL"      "ENLACES1"
# Save csv.
# CAMBIA EL NOMBRE! NO TE OLVIDES!
# Y PONLE UN # ANTES DE GUARDAR EL SCRIPT!
write.csv(covid_ind, "data/modificadas/covidPE_IND_20200403_MD_clean.csv")
library(ggplot2)
library(ggmap)
library(data.table)
library(maptools)
library(rgeos)
library(Cairo)
library(scales)
library(RColorBrewer)
library(rgdal)
library(sp)
library(plyr)
library(tmap)
library(dplyr)
setwd("~/covid19/")
## Call data
# shapefile de peru por regiones
shpfile_peru <- "data/gadm0-1-2-3/peru_1.shp"
sh_peru <- rgdal::readOGR(shpfile_peru)
# casos de covid
#caso_covid <- fread("~/covid19/data/modificadas/covidPE_IND_20200402_MD_clean.csv")
caso_covid <- fread("~/covid19/data/modificadas/covidPE_IND_20200403_MD_clean.csv")
# tabla de poblacion por regiones
pob_region <- read.csv("~/covid19/data/Poblacion por region.csv")
## Check the neighborhood shapefile data and plot
sh_peru@data$NAME_1
# Que quede solo una Lima
sh_peru$NAME_1 <- recode(sh_peru$NAME_1, `Lima Province` = "Lima")
unique(sh_peru$NAME_1)
sh_peru$NAME_1 <- factor(sh_peru$NAME_1)
levels(sh_peru@data$NAME_1)
# Change names
str(sh_peru@data)
levels(sh_peru$NAME_1) <- c(levels(sh_peru$NAME_1),
c("Apurimac", "Huanuco",
"Junin", "San Martin"))
sh_peru_df <- sh_peru@data
sh_peru[3,6] <- "Apurimac"
sh_peru[9,6] <- "Huanuco"
sh_peru[12,6] <- "Junin"
sh_peru[23,6] <- "San Martin"
sh_peru_df <- sh_peru@data
sh_peru@data$NAME_1 <- factor(sh_peru@data$NAME_1)
levels(sh_peru@data$NAME_1)
## plotting shapefiles
plot(sh_peru)
# Transformar a mayusculas
sh_peru[[6]] <- toupper(sh_peru[[6]])
str(sh_peru@data$NAME_1)
unique(sh_peru@data$NAME_1)
## Check data of cases
names(caso_covid)
colnames(caso_covid)[1] <- "CE4_ID"
colnames(caso_covid)[7] <- "NAME_1"
unique(caso_covid$NAME_1)
casos_region <- data.frame(table(caso_covid$NAME_1))
colnames(casos_region)[1] <- "REGION"
colnames(casos_region)[2] <- "NUMERO_CASOS"
## Checar csv de poblaciones regionales
names(pob_region) # "REGION"    "POBLACION"
pob_region[[1]] <- toupper(pob_region[[1]])
unique(pob_region$REGION) # todo ok
## Merge cases with populations
region_values <- merge(casos_region, pob_region, by="REGION",
all.x=T, all.y=T)
## Calcula incidencias
region_values$NUMERO_CASOS <- as.numeric(region_values$NUMERO_CASOS)
region_values$POBLACION <- as.numeric(as.character(region_values$POBLACION))
region_values$incidencia <- region_values$NUMERO_CASOS/region_values$POBLACION
options(digits = 2)
region_values$incidencerate_100 <-(region_values$incidencia*100000)
## recode the names of the region_values data frame
setnames(region_values, old = "REGION",new = "NAME_1")
levels(region_values$NAME_1)
## Create labels that does not occupy
region_values$NAME_LABEL <- region_values$NAME_1
str(region_values$NAME_LABEL)
region_values$NAME_LABEL <- revalue(region_values$NAME_LABEL,
c("ANCASH"="ANC",
"AREQUIPA"="AQP",
"AYACUCHO" ="AYA",
"CAJAMARCA"="CAJ",
"CALLAO"="CAL",
"CUSCO" ="CUS",
"HUANUCO" ="HCO",
"ICA" ="ICA",
"JUNIN" ="JUN",
"LA LIBERTAD" ="LAL",
"LAMBAYEQUE" ="LAM",
"LIMA" ="LIM",
"LORETO"="LOR",
"MADRE DE DIOS"="MDD",
"PASCO" ="PAS",
"PIURA"="PIU",
"SAN MARTIN"="SAM",
"TACNA" ="TAC",
"TUMBES" ="TUM",
"AMAZONAS" ="AMA",
"MOQUEGUA"="MOQ",
"APURIMAC"="APU",
"HUANCAVELICA"="HUV",
"PUNO"="PUN",
"UCAYALI"="UCA"))
View(region_values)
## Merge data with shapefile
tmp1 <- sh_peru
tmp1_map <- tmp1
tmp1_map@data <- join(sh_peru@data,region_values, by="NAME_1") # shp with data
tmp1_map_df <- tmp1_map@data
# tmp1_map@data$NUMERO_CASOS[is.na(tmp1_map@data$NUMERO_CASOS)]<-0
# tmp1_map@data$incidencia[is.na(tmp1_map@data$incidencia)]<-0
# tmp1_map@data$incidencerate_100[is.na(tmp1_map@data$incidencerate_100)]<-0
tmp1_map_df <- tmp1_map@data
# tmp1_map@data$brks <- cut(tmp1_map@data$incidencerate_100,
#                            breaks=c(-0.1, 0.0, 1, 2, 3, 4, 5, 6),
#                            labels=c("Sin casos reportados", "0 a 1", "1 a 2", "2 a 3",
#                                     "3 a 4", "4 a 5", "5 a 6"))
names(tmp1_map@data) # check variables
tmp1_map_df <- tmp1_map@data
col <- c("ivory2", "lightcyan1", "lightblue2", #"lightskyblue",
"royalblue", "blue2", "navyblue", "black")
# interactive view
tmap_mode("view")
# crear mapa
qtm <- qtm(tmp1_map, fill = "incidencerate_100",
fill.palette = col,
fill.title="Incidencia por \n100,000 Hab") +
# tm_text("NAME_3", size="0.008", scale=1, root=4,
#         size.lowerbound = .1, bg.color="white", bg.alpha = .15,
#         legend.size.show = FALSE) +
tm_text("NAME_LABEL",size = 0.5)+
tm_layout(paste("Casos por \nregión \nCOVID19 "), title.size = 1,
legend.title.size = 0.8,
legend.text.size = .6, legend.bg.color = "white",
legend.position = c("left","bottom")) #+
print(qtm)
tmap_save(qtm,
paste("outputs_covid19/20200403_Dep_COVID19_Incidencerate",".png", sep=""),
width=2300, height=1380)
library(JLutils)
library(magrittr)
library(ggthemr)
library(ggplot2)
library('incidence')
library('outbreaks')
setwd('~/covid19/outputs_covid19/')
acumulado_dep<-fread("~/covid19/data/modificadas/covidPE_IND_20200403_MD_clean.csv")
i.7.group <- incidence(acumulado_dep$FECHA, interval = 7,
groups = acumulado_dep$REGION)
install.packages("jlutils")
install.packages("ggthemr")
# plot
my_theme <- theme_bw(base_size = 12) +
theme(panel.grid.minor = element_blank()) +
theme(axis.text.x = element_text(angle = 90,
hjust = 1, vjust = 0.5, color = "black"))
# save plot
png(filename="20200403_weekly_incid_COVID19.png")
plot(i.7.group, border = "white", ylab="Numero de casos por semana") +
my_theme +
# theme(legend.position = "topleft")
theme(legend.position = c(-1.0, -1.0))
dev.off()
# daily
i.7.group <- incidence(acumulado_dep$FECHA, interval = 1,
groups = acumulado_dep$REGION)
# plot
my_theme <- theme_bw(base_size = 12) +
theme(panel.grid.minor = element_blank()) +
theme(axis.text.x = element_text(angle = 90,
hjust = 1, vjust = 0.5, color = "black"))
png(filename="20200403_daily_incid_COVID19.png")
plot(i.7.group, border = "white", ylab="Número de casos por día") +
my_theme +
# theme(legend.position = "topleft")
theme(legend.position = c(-1.0, -1.0))
dev.off()
library(JLutils)
library(magrittr)
library(ggthemr)
library(ggplot2)
library('incidence')
library('outbreaks')
setwd('~/covid19/outputs_covid19/')
####casos_acumulado por semana#####
### weekly incidense #####
acumulado_dep<-fread("~/covid19/data/modificadas/covidPE_IND_20200403_MD_clean.csv")
#acumulado_dep <- mutate_if(acumulado_dep, is.character, toupper)
#acumulado_dep<-acumulado_dep %>%
#  mutate(Fecha = as.Date(as.character(Fecha), format = "%d/%m/%y"))
#str(acumulado_dep, strict.width = "cut", width = 76)
i.7.group <- incidence(acumulado_dep$FECHA, interval = 7,
groups = acumulado_dep$REGION)
# plot
my_theme <- theme_bw(base_size = 12) +
theme(panel.grid.minor = element_blank()) +
theme(axis.text.x = element_text(angle = 90,
hjust = 1, vjust = 0.5, color = "black"))
# save plot
png(filename="20200403_weekly_incid_COVID19.png")
plot(i.7.group, border = "white", ylab="Número de casos por semana") +
my_theme +
# theme(legend.position = "topleft")
theme(legend.position = c(-1.0, -1.0))
dev.off()
